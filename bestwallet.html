<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>BestWallet API</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

  </head>

  <body class="bestwallet">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <!--<img src="images/logo.png" />-->
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='mserver.html'>Mserver API</a></li>
            <li><a href='mserver_admin.html'>Mserver Admin API</a></li>
            <li><a href='bestwallet.html'>BestWallet API</a></li>
            <li><a href='bw_admin.html'>BestWallet Admin API</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        
          <h1 id='oshibki'>Ошибки</h1>
<p>API использует HTTP статусы для возврата ошибок.</p>

<table><thead>
<tr>
<th style="text-align: center">Статус</th>
<th>Описание</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">200</td>
<td>запрос выполнен успешно</td>
</tr>
<tr>
<td style="text-align: center">304</td>
<td>документ не изменился с указанного момента</td>
</tr>
<tr>
<td style="text-align: center">400</td>
<td>плохо сформированный запрос (например невалидный JSON)</td>
</tr>
<tr>
<td style="text-align: center">401</td>
<td>неверные учетные данные</td>
</tr>
<tr>
<td style="text-align: center">404</td>
<td>запрошенный ресурс не существует (для запрашивающего)</td>
</tr>
<tr>
<td style="text-align: center">405</td>
<td>не тот HTTP метод, например GET вместо POST</td>
</tr>
<tr>
<td style="text-align: center">415</td>
<td>не тот content-type, мы поддерживаем только application/json</td>
</tr>
<tr>
<td style="text-align: center">422</td>
<td>запрос сформирован нормально, но не прошел валидацию, например не хватает полей или поле не в нужном формате</td>
</tr>
<tr>
<td style="text-align: center">5XX</td>
<td>проблема с mserver, повторите запрос позже</td>
</tr>
</tbody></table>

<p>HTTP статус дублируется в поле <code class="prettyprint">meta.status</code> ответа mserver. В определенных случаях вместе со статусом возвращается уточненный код ошибки в поле <code class="prettyprint">meta.error</code>. Например для невалидного номера телефона при создании кошелка возвращается</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">422</span><span class="p">,</span><span class="w">
    </span><span class="s2">"error"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"invalid_phone"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"error_message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Неверный телефон"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='poluchenie-oshibok-api'>Получение ошибок API</h2>
<p>Поля:</p>

<ul>
<li><code class="prettyprint">code</code> - идентификатор ошибки</li>
<li><code class="prettyprint">title</code> - словарь с локализированными ошибками</li>
</ul>

<p>Поле <code class="prettyprint">title</code> может быть с динамическими данными, например <code class="prettyprint">{{ object.meta.code }}</code> при получении реальной ошибки отдаст http код состояния</p>

<p>В ответе в <em>meta</em> присутствует параметр <strong>request_time</strong> со значением UNIX timestamp.
Если делать запрос с параметром <strong>If-Modified-Since</strong> в котором будет указан timestamp предыдущего запроса, то ответ может быть с HTTP кодом 304</p>
<pre class="highlight shell"><code><span class="gp">$ </span>curl http://sandbox.wallet.best/v1/errors
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"request_time"</span><span class="p">:</span><span class="w"> </span><span class="mi">1432652055</span><span class="p">,</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"wallet_not_found"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"ru_RU"</span><span class="p">:</span><span class="w"> </span><span class="s2">"кошелек не существует"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"invalid_phone"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"ru_RU"</span><span class="p">:</span><span class="w"> </span><span class="s2">"требуется номер телефона в международном формате"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"en_US"</span><span class="p">:</span><span class="w"> </span><span class="s2">"invalid phone {{ object.meta.code }}"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Справочники возможных значений error для каждого вызова API описаны ниже.</p>
<h2 id='meta'>Meta</h2>
<p>Любой успешный запрос с кошельком будет возвращать в поле <code class="prettyprint">meta</code> следующие поля:</p>

<ul>
<li><code class="prettyprint">code</code> - код состояния HTTP</li>
<li><code class="prettyprint">urgent_data</code> - массив с оперативной информацией:

<ul>
<li><code class="prettyprint">amount</code> - текущее кол-во денег в кошельке</li>
<li><code class="prettyprint">unseen_payments</code> - кол-во непросмотренных транзакций в логе</li>
</ul></li>
</ul>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="s2">"urgent_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">2370</span><span class="p">,</span><span class="w">
            </span><span class="s2">"unseen_payments"</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='autentifikatsiya'>Аутентификация</h2>
<p>Используется <a href="http://nebo15.github.io/mbank.docs/mserver.html#oauth">OAuth аутентификация</a>. 
В качестве логина используется номер телефона Кошелька в международном формате. В случае, если кошелек не прошел аутентификацию, сервер вернет HTTP статус 401.</p>

<p>Коды ошибок</p>

<ul>
<li><code class="prettyprint">wallet_not_active</code> - кошелек не активирован</li>
<li><code class="prettyprint">wallet_disabled</code> - заблокирован администрацией</li>
</ul>
<h1 id='nastroyki-prilozheniya'>Настройки приложения</h1><pre class="highlight shell"><code><span class="gp">$ </span>curl -u +79261111111:p@ssw0rD http://sandbox.wallet.best/v1/options
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"support_phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+380991032585"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"mobile_operators_category_ids"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"ru"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

          <h1 id='koshelek'>Кошелек</h1>
<p><em>Кошелек - учетная запись конечного пользователя в mserver. Позволяет получать информацию о доступном остатке на счете и персональных данных конечного пользователя.</em></p>

<p>Поля:</p>

<ul>
<li><code class="prettyprint">phone</code> - номер телефона в международном формате, уникальный идентификатор Кошелька (в пределах Проекта), также является логином</li>
<li><code class="prettyprint">amount</code> - остаток на счете кошелька, в рублях</li>
<li><code class="prettyprint">name</code> - имя конечного пользователя, возвращается в случае, если были заданы имя и/или фамилия</li>
<li><code class="prettyprint">verified</code> - <strong>true | false</strong> статус идентификации пользователя</li>
<li><code class="prettyprint">level</code> - <strong>anonymous | identified | personified</strong> уровень идентификации пользователя</li>
<li><code class="prettyprint">person_status</code> - <strong>no_data | data_entered | data_verified</strong> статус персональных данных пользователя</li>
<li><code class="prettyprint">email</code> - электронная почта пользователя</li>
<li><code class="prettyprint">email_send_frequency</code> - <strong>never | after_payment | daily | monthly</strong> периодичность отправки на почту лога транзакций</li>
</ul>
<h2 id='sozdanie-koshelka'>Создание кошелька</h2>
<p>Mserver: http://nebo15.github.io/mbank.docs/mserver.html#sozdanie-koshelka</p>
<h2 id='aktivatsiya-koshelka'>Активация кошелька</h2>
<p>Mserver: http://nebo15.github.io/mbank.docs/mserver.html#aktivatsiya-koshelka</p>
<h2 id='zapros-povtornoy-otpravki-koda-aktivatsii'>Запрос повторной отправки кода активации</h2>
<p>Mserver: http://nebo15.github.io/mbank.docs/mserver.html#zapros-povtornoy-otpravki-koda-aktivatsii</p>
<h2 id='zapros-koda-dlya-smeny-parolya'>Запрос кода для смены пароля</h2>
<p>Mserver: http://nebo15.github.io/mbank.docs/mserver.html#zapros-koda-dlya-smeny-parolya</p>
<h2 id='smena-parolya'>Смена пароля</h2>
<p>Mserver: http://nebo15.github.io/mbank.docs/mserver.html#smena-parolya</p>
<h2 id='zagruzka-koshelka'>Загрузка кошелька</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:p@ssw0rD http://sandbox.wallet.best/v1/wallet
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="s2">"urgent_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">1237</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"time"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.363231</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">1237</span><span class="p">,</span><span class="w">
        </span><span class="s2">"level"</span><span class="p">:</span><span class="w"> </span><span class="s2">"identified"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Петян"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"verified"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="s2">"person_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data_verified"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"picture_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http:\/\/sandbox.wallet.best\/img\/wallets\/7a\/91c\/54291c7a56c35f205da91f9d.jpg?1424445896"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"test@wallet.best"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"can_use_autopayments"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="s2">"intercom_user_hash"</span><span class="p">:</span><span class="w"> </span><span class="s2">"82bdad9a133b1efda3aeba7b3a78e00afd0d8f4dc5a604b06663a2d6f07fc9b2"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='udalenie-koshelka'>Удаление кошелька</h2>
<p><em>Метод не работает на prod.</em></p>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u admin_level_login:password -X DELETE http://sandbox.wallet.best/v1/wallet/%2B79261111111
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='vnesenie-personalnyh-dannyh-polzovatelya'>Внесение персональных данных пользователя</h2>
<p>Проверяются на дубликат по <code class="prettyprint">passport_series_number</code>.</p>

<p>Параметры</p>

<ul>
<li><code class="prettyprint">family_name</code> - <strong>обязательный параметр</strong> - фамилия</li>
<li><code class="prettyprint">given_name</code> - <strong>обязательный параметр</strong> - имя</li>
<li><code class="prettyprint">passport_series_number</code> - <strong>обязательный параметр</strong> - серия и номер паспорта, 10 цифр</li>
<li><code class="prettyprint">patronymic_name</code> - отчество</li>
<li><code class="prettyprint">passport_issued_at</code> - дата в формате гггг-мм-дд</li>
<li><code class="prettyprint">itn</code> - ИНН, 12 цифр</li>
<li><code class="prettyprint">ssn</code> - СНИЛС, 11 цифр</li>
</ul>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span>
-d <span class="s1">'{"family_name": "Арсеньев", "given_name": "Алексей", "patronymic_name": "Александрович",
"passport_series_number": "2202655885", "passport_issued_at" : "2012-02-27",
"itn": "330500938709", "ssn": "11223344595"}'</span>
http://sandbox.wallet.best/v1/wallet/person
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"family_name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Арсеньев"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"given_name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Алексей"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"patronymic_name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Александрович"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"passport_series_number"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2202655885"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"passport_issued_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-02-27"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"itn"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"330500938709"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ssn"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"11223344595"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"data_entered"</span><span class="w">
    </span><span class="s2">"changed_at"</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="s2">"2014-11-14T13:15:42.213Z"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Коды ошибок</p>

<ul>
<li><code class="prettyprint">invalid_family_name</code> - фамилия длиннее 512 символов</li>
<li><code class="prettyprint">invalid_given_name</code> - имя длиннее 512 символов</li>
<li><code class="prettyprint">invalid_patronymic_name</code> - отчество длиннее 512 символов</li>
<li><code class="prettyprint">invalid_passport_series_number</code> - серия/номер паспорта не соответствует формату</li>
<li><code class="prettyprint">invalid_itn</code> - ИНН не соответствует формату</li>
<li><code class="prettyprint">invalid_ssn</code> - СНИЛС не соответствует формату</li>
<li><code class="prettyprint">person_already_verified</code> - перcональные данные утверждены, изменение невозможно, обратитесь в поддержку</li>
<li><code class="prettyprint">duplicate_person</code> - указанные персональные данные уже были использованы для идентификации другого кошелька</li>
</ul>
<h2 id='zagruzka-personalnyh-dannyh-polzovatelya'>Загрузка персональных данных пользователя</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:p@ssw0rD http://sandbox.wallet.best/v1/wallet/person
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"family_name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Арсеньев"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"given_name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Алексей"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"patronymic_name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Александрович"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"passport_series_number"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2202655885"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"passport_issued_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-02-27"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"itn"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"330500938709"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ssn"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"11223344595"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"data_verified"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"verified_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-05-29T17:06:20.066Z"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='zagruzka-kartinki'>Загрузка картинки</h2>
<p>Форматы: JPEG, PNG. На сервере делается auto-rotate. Размер файла до 10 мегабайт.</p>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u +79261111111:p@ssw0rD -X POST -F <span class="s2">"file=@/path/to/image.jpg"</span> http://sandbox.wallet.best/v1/wallet/picture
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
    </span><span class="p">},</span><span class="w">
</span><span class="err">}</span><span class="w">
</span></code></pre>
<h2 id='udalenie-kartinki'>Удаление картинки</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -u +79261111111:p@ssw0rD -X DELETE http://sandbox.wallet.best/v1/wallet/picture
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
    </span><span class="p">},</span><span class="w">
</span><span class="err">}</span><span class="w">
</span></code></pre>
<h2 id='poisk-koshelkov'>Поиск кошельков</h2>
<p>Параметры</p>

<ul>
<li><code class="prettyprint">contacts</code> - массив объектов с контактами <code class="prettyprint">{&quot;name&quot;:&quot; Daniel Higgins&quot;,&quot;phone&quot;:&quot; +5554787672&quot;}</code> или массив с номерами телефонов в формате <code class="prettyprint">{&quot;phone&quot;: &quot;+79990000000&quot;}</code></li>
</ul>

<p>Если искомый кошелек не активирован, то он не найдется.</p>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u +12345675578:password -H <span class="s1">'Content-type:application/json'</span> -d <span class="s1">'{"contacts": [ {"phone": "+79990000000"}, {"phone": "+79260000001"}, {"phone": "+79260000002"} ]}'</span> http://sandbox.wallet.best/v1/wallet/find
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"+79990000000"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"+79260000002"</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='poluchenie-spiska-tochek-popolnenya'>Получение списка точек пополненя</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -u +12345675578:password http://sandbox.wallet.best/v1/wallet/replenishment_points
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54635060279871e2098b4567"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Банкомат: Инвестбанк ОАО АКБ"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"worktime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"пн-пт: 09:00-20:00, сб: 10:00-16:00"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Москва ул. Ворошилова 169-171"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"latitude"</span><span class="p">:</span><span class="w"> </span><span class="mf">55.616371</span><span class="p">,</span><span class="w">
            </span><span class="s2">"longitude"</span><span class="p">:</span><span class="w"> </span><span class="mf">37.211893</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54635060279871e2098b4568"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Касса: СЛАВИНВЕСТБАНК ООО"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"worktime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"круглосуточно"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Москва ул. маршала Жукова 1"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"latitude"</span><span class="p">:</span><span class="w"> </span><span class="mf">55.676006</span><span class="p">,</span><span class="w">
            </span><span class="s2">"longitude"</span><span class="p">:</span><span class="w"> </span><span class="mf">37.252398</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='nastroyka-periodichnosti-otpravki-na-pochtu-loga-tranzaktsiy'>Настройка периодичности отправки на почту лога транзакций</h2>
<p>Параметры</p>

<ul>
<li><code class="prettyprint">email</code> - электронная почта получателя выписки</li>
<li><code class="prettyprint">email_send_frequency</code> - <strong>never | after_payment | daily | monthly</strong> периодичность отправки на почту лога транзакций</li>
</ul>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u +12345675578:password -d <span class="s1">'{"email" : "test@wallet.best", "email_send_frequency" : "daily"}'</span> http://sandbox.wallet.best/v1/wallet/settings
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="err">{</span><span class="w">
        </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="err">}</span><span class="w">
</span></code></pre>
<h2 id='webhook-izmeneniya-statusa-koshelka-verifiedpersonified'>Webhook изменения статуса кошелька (verified/personified)</h2>
<p>Параметры</p>

<ul>
<li><code class="prettyprint">webhook_client_id</code> - id клиента (обязательно)</li>
<li><code class="prettyprint">webhook_client_token</code> - токен клиента (обязательно)</li>
<li><code class="prettyprint">phone</code> - Номер телефона кошелька (обязательно)</li>
<li><code class="prettyprint">verified</code> - true</li>
<li><code class="prettyprint">personified</code> - true</li>
</ul>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -H <span class="s1">'Content-type:application/json'</span> -d <span class="s1">'{"phone": "+12345675578", "verified": true}'</span> http://sandbox.wallet.best/v1/wallet/status?webhook_client_id<span class="o">=</span>mserver&amp;webhook_client_token<span class="o">=</span>token

</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="err">{</span><span class="w">
        </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="err">}</span><span class="w">
</span></code></pre>

          <h1 id='servisy'>Сервисы</h1>
<p><em>Сервис - это назначение платежа. Сервис содержит описание параметров, которые должны быть переданы в платежном запросе
конечным пользователем.</em></p>

<p>Параметры сервисов мапятся в админке, потому могут отличаться от MServer.
Когда пользователь заполняется данные для сервиса, они попадают в базу знаний, на основе которой можно выделить шаблоны для параметров.</p>

<p>Поля:</p>

<ul>
<li><code class="prettyprint">id</code> - идентификатор сервиса, передается в платежном запросе в поле <code class="prettyprint">service</code> для указания назначения платежа</li>
<li><code class="prettyprint">name</code> - человекочитаемое имя сервиса</li>
<li><code class="prettyprint">keywords</code> - подсказки для поиска (ключевые слова через запятую)</li>
<li><code class="prettyprint">minsum</code>, <code class="prettyprint">maxsum</code> - минимальная и максимальная сумма платежа, включительно</li>
<li><code class="prettyprint">status</code> - <strong>online | offline</strong> статус доступности сервиса для совершения платежей</li>
<li><code class="prettyprint">verification_required</code> - требуется ли идентификация плательщика для проведения платежа,</li>
<li><code class="prettyprint">parameters</code> - массив параметров для платежа, содержит в себе объекты со свойствами, которые описаны ниже.</li>
<li><code class="prettyprint">category</code> - объект со следующими свойствами (DEPRECATED):</li>
<li><code class="prettyprint">groups</code> - массив групп (категорий) к которым относится сервис</li>
<li><code class="prettyprint">rate</code> - комиссия в формате массива со значениями:

<ul>
<li><code class="prettyprint">fix</code> - фиксированная</li>
<li><code class="prettyprint">percent</code> - процент от суммы</li>
<li><code class="prettyprint">min</code> - минимальный размер комиссии, опционально</li>
<li><code class="prettyprint">max</code> - максимальный размер комиссии, опционально</li>
</ul></li>
</ul>

<p>Параметры:</p>

<ul>
<li><code class="prettyprint">id</code> - идентификатор параметра. Может дублироваться с другим параметром ТОЛЬКО в другом сервисе</li>
<li><code class="prettyprint">is_disabled</code> - состояние параметра. Неактивен</li>
<li><code class="prettyprint">is_hidden</code> - состояние параметра. Невидимый</li>
<li><code class="prettyprint">is_required</code> - состояние параметра. Обязательный</li>
<li><code class="prettyprint">min_length</code>, <code class="prettyprint">max_length</code> - минимальная и максимальная длина значения параметра платежа</li>
<li><code class="prettyprint">patterns</code> - массив объектов со следующими свойствами:

<ul>
<li><code class="prettyprint">pattern</code> - регулярное выражение, которому должно удовлетворять значение параметра платежа</li>
<li><code class="prettyprint">description</code> - человекочитаемый текст ошибки, если значение не попадает под выражение <code class="prettyprint">pattern</code></li>
</ul></li>
<li><code class="prettyprint">pattern</code> - регулярное выражение, которому должно удовлетворять значение параметра платежа</li>
<li><code class="prettyprint">pattern_description</code> - человекочитаемый текст ошибки, если значение не попадает под выражение <code class="prettyprint">pattern</code></li>
<li><code class="prettyprint">type</code> - типы мапятся, могут добавлятся или изменятся. Существуют устоявшиеся:

<ul>
<li>string - строка</li>
<li>phone - телефон</li>
<li>email - почта</li>
<li>number - число</li>
<li>enum - выбор</li>
</ul></li>
<li><code class="prettyprint">title</code> - человекочитаемое имя параметра</li>
<li><code class="prettyprint">default_value</code> - человекочитаемое имя параметра</li>
<li><code class="prettyprint">suggested_values</code> - человекочитаемое имя параметра</li>
<li><code class="prettyprint">items</code> - возможные значения параметра платежа с типом enum</li>
<li><code class="prettyprint">range_start</code> - <strong>Необязательно поле</strong>. Начало диапазона чисел</li>
<li><code class="prettyprint">range_end</code> - <strong>Необязательно поле</strong>. Конец диапазона чисел</li>
</ul>

<p>Поля <code class="prettyprint">range_start</code> и <code class="prettyprint">range_end</code> нужны для создания диапазона чисел.
Например нужно сделать выбор по годам начиная от 1901 и заканчивая 2000</p>
<h2 id='zagruzka-spiska-servisov'>Загрузка списка сервисов</h2>
<p>Список отдается с постраничной навигацией. Если существует следующая страница с сервисами - в <em>meta</em> параметр <strong>has_next_page</strong> будет true, в ином случае - false.</p>

<p>В ответе в <em>meta</em> присутствует параметр <strong>request_time</strong> со значением UNIX timestamp.
Если делать запрос с параметром <strong>If-Modified-Since</strong> в котором будет указан timestamp предыдущего запроса, то ответ может быть с HTTP кодом 304.</p>

<p>В <em>meta</em> возвращаются <em>suggestions</em> в количестве до 5 с учетом <em>geo</em> и <em>project_id</em>. Это сервисы отсортированные по количеству платежей за месяц в обратном порядке.</p>

<p>Параметры:</p>

<ul>
<li><code class="prettyprint">size</code> - кол-во элементов в списке (по-умолчанию 20)</li>
<li><code class="prettyprint">page</code> - страница (по-умолчанию 1)</li>
<li><code class="prettyprint">group_id</code> - id группы. Не обязательно.</li>
<li><code class="prettyprint">name</code> - подстрока, входящая (в любом месте) в название сервиса или в keywords. Не обязательно.</li>
<li><code class="prettyprint">geo_id</code> - Не обязательно.</li>
</ul>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:p@ssw0rD http://sandbox.wallet.best/v1/services
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"request_time"</span><span class="p">:</span><span class="w"> </span><span class="mi">1407428185</span><span class="p">,</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="s2">"has_next_page"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="s2">"urgent_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">2370</span><span class="p">,</span><span class="w">
            </span><span class="s2">"unseen_payments"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"suggestions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w">
                </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Теле2"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"keywords"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"online"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"icon_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http:\/\/api.mbank.dev\/img\/services\/53359fb2255c741a749f0c44.png?1432896868"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"limit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Лимитов нет"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"rate"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"fix"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"percent"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="s2">"verification_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"53359fb2255c741a749f0c42"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Мобильная связь"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1161</span><span class="p">,</span><span class="w">
                </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Steam"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"keywords"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"online"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"icon_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http:\/\/api.mbank.dev\/img\/services\/53a6f8f456c35f166462c6c8.png?1432896868"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"limit"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                </span><span class="s2">"rate"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"fix"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"percent"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="s2">"verification_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"53359fb2255c741a749f0c47"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Игры и социальные сети"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">834</span><span class="p">,</span><span class="w">
                </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"МегаФон"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"keywords"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"online"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"icon_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http:\/\/api.mbank.dev\/img\/services\/542949a556c35f205de5a52d.png?1432896868"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"limit"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                </span><span class="s2">"rate"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"fix"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"percent"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="s2">"verification_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"53359fb2255c741a749f0c42"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Мобильная связь"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Мегафон"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"keywords"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"online"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"icon_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https:\/\/api.mbank.ru\/img\/providers\/dev_834.png"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"limit"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"rate"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"fix"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">"percent"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"verification_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="s2">"groups"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"53359fb2255c741a749f0c4b"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Интернет провайдеры"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="s2">"geo"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"Москва"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"Центральный округ"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"Российская Федерация"</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"Питер"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"Вохомский район"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"Костромская область"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"Центральный округ"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"Российская Федерация"</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Tele2"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"keywords"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"offline"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"icon_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https:\/\/api.mbank.ru\/img\/providers\/dev_1000.png"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"limit"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"rate"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"fix"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">"percent"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"verification_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="s2">"groups"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"53359fb2255c741a749f0c59"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Мобильная связь зарубежья"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='zagruzka-spiska-grupp'>Загрузка списка групп</h2>
<p>Поле <code class="prettyprint">amount</code> содержит количество включенных сервисов в группе. В ответе в meta присутствует параметр request_time со значением UNIX timestamp.
Если делать запрос с параметром <strong>If-Modified-Since</strong> в котором будет указан timestamp предыдущего запроса, то ответ может быть с HTTP кодом 304</p>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u +79261111111:p@ssw0rD http://sandbox.wallet.best/v1/groups
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"request_time"</span><span class="p">:</span><span class="w"> </span><span class="mi">1423147436</span><span class="p">,</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="s2">"urgent_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">2370</span><span class="p">,</span><span class="w">
            </span><span class="s2">"unseen_payments"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Мобильная связь"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"keywords"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cellular"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cellular"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">895</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Мобильная связь зарубежья"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"keywords"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Игры и социальные сети"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"keywords"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='zagruzka-spiska-servisov-po-gruppam'>Загрузка списка сервисов по группам</h2>
<p>В ответе в meta присутствует параметр request_time со значением UNIX timestamp.
Если делать запрос с параметром <strong>If-Modified-Since</strong> в котором будет указан timestamp предыдущего запроса, то ответ может быть с HTTP кодом 304.</p>

<p>В метаданных есть поле <code class="prettyprint">suggestion_rules</code> c массивом <strong>код оператора в международном формате</strong> : <strong>ID сервиса</strong>
<code class="prettyprint">shell
$ curl -u+79261111111:p@ssw0rD http://sandbox.wallet.best/v1/services/groups
</code></p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"request_time"</span><span class="p">:</span><span class="w"> </span><span class="mi">1407182553</span><span class="p">,</span><span class="w">
        </span><span class="s2">"suggestion_rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"+7920"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"+7939"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"+7900"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
            </span><span class="s2">"+7968"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
            </span><span class="s2">"+7910"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
            </span><span class="s2">"+7911"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
            </span><span class="s2">"+7901"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
            </span><span class="s2">"+7953"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Мобильная связь"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cellular"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cellular"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"services"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="err">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Tele2"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"online"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"icon_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https:\/\/api.mbank.ru\/img\/providers\/dev_1000.png"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"limit"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"rate"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="s2">"fix"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"percent"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="s2">"verification_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="err">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">770</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Билайн"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"online"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"icon_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https:\/\/api.mbank.ru\/img\/providers\/dev_770.png"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"limit"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"rate"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="s2">"fix"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"percent"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="s2">"verification_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="err">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Игры и социальные сети"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"services"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="err">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1066</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Одноклассники"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"online"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"icon_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https:\/\/api.mbank.ru\/img\/providers\/dev_1068.png"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"limit"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
                    </span><span class="s2">"rate"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="s2">"fix"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"percent"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="s2">"verification_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="err">}</span><span class="w">
    </span><span class="err">}</span><span class="w">
</span><span class="err">}</span><span class="w">
</span></code></pre>
<h2 id='informatsiya-o-servise-po-id'>Информация о сервисе по id</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:p@ssw0rD http://sandbox.wallet.best/v1/services/42
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">770</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Билайн"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"keywords"</span><span class="p">:</span><span class="w"> </span><span class="s2">"билайн, белайн, белаин, пчелайн"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"icon_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https:\/\/api.mbank.ru\/img\/providers\/dev_770.png"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"limit"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="s2">"rate"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"fix"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="s2">"percent"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"minsum"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
        </span><span class="s2">"maxsum"</span><span class="p">:</span><span class="w"> </span><span class="mi">15000</span><span class="p">,</span><span class="w">
        </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"online"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"verification_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="s2">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_disabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"min_length"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
                </span><span class="s2">"max_length"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
                </span><span class="s2">"range_start"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                </span><span class="s2">"range_end"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
                </span><span class="s2">"patterns"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="s2">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^\\d{10}$a"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"№ телефона не 10 цифр"</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="s2">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^\\d{16}$a"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"№ карточки не 16 цифр"</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="s2">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^\\d{10}$a"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"pattern_desc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10 цифр"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phone"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Номер телефона"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"default_value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[phone:+79267101280]"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"suggested_values"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"+79267101280"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"+79267101250"</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Оплата по № Догoвора"</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Оплата по № Карты"</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Оплата по № Счета"</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="s2">"service_param_pattern_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_changed"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"549c92fb56c35f660ecd341f"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Мобильная связь"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cellular"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cellular"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"groups"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"53359fb2255c741a749f0c42"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Мобильная связь"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cellular"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cellular"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"keywords"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">"services_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='poisk-servisa-po-mnp'>Поиск сервиса по MNP</h2>
<p>Параметры (все обязательны):</p>

<ul>
<li><code class="prettyprint">provider_id</code></li>
<li><code class="prettyprint">provider_region_code</code></li>
</ul>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:p@ssw0rD http://sandbox.wallet.best/v1/services/mnp?provider_id<span class="o">=</span>beline&amp;provider_region_code<span class="o">=</span>ru
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">770</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Билайн"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"keywords"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="s2">"icon_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http:\/\/api.mbank.dev\/img\/services\/53359fb2255c741a749f0c45.png?1433497473"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"limit"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="s2">"minsum"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
        </span><span class="s2">"maxsum"</span><span class="p">:</span><span class="w"> </span><span class="mi">15000</span><span class="p">,</span><span class="w">
        </span><span class="s2">"rate"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"fix"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="s2">"percent"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"online"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"verification_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="s2">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_disabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="s2">"min_length"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
                </span><span class="s2">"max_length"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
                </span><span class="s2">"range_start"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">"range_end"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">"patterns"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="s2">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="s2">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^\\+7[0-9]{10}$"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                            </span><span class="s2">"ru_RU"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Номер телефона РФ начиная с +7 (в международном формате). Например, +79261112233"</span><span class="w">
                        </span><span class="p">}</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="s2">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^\\+7[0-9]{10}$"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"pattern_desc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Номер телефона РФ начиная с +7 (в международном формате). Например, +79261112233"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phone"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Номер телефона, начиная с +7"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"default_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"suggested_values"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"53359fb2255c741a749f0c42"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"mserver_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"53359fb2255c741a749f0c42"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Мобильная связь"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cellular"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"keywords"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"icon_url_32x32"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='opredelenie-opsosa-po-nomeru-telefona'>Определение ОПСОСа по номеру телефона</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl http://sandbox.wallet.best/v1/services/mobile/79261111111
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">834</span><span class="p">,</span><span class="w">
    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"МегаФон"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"icon_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://sandbox.wallet.best/img/providers/dev_834.png"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"limit"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="s2">"rate"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"fix"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="s2">"percent"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"minsum"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"maxsum"</span><span class="p">:</span><span class="w"> </span><span class="mi">15000</span><span class="p">,</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Номер телефона"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"pattern_desc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10 цифр"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"min_length"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
        </span><span class="s2">"max_length"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phone"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='zayavka-na-dobavlenie-novogo-servisa'>Заявка на добавление нового сервиса</h2>
<p>Создает в Intercom.io завку на добавление сервиса.</p>

<p>Параметры:</p>

<ul>
<li><code class="prettyprint">title</code> - наименование сервиса</li>
</ul>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -X POST -H <span class="s1">'Content-type:application/json'</span>
-u+79261111111:p@ssw0rD -d <span class="s1">'{"title" : "%SERVICE TITLE%" }'</span>
http://sandbox.wallet.best/v1/services/order
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="mi">1407185953</span><span class="p">,</span><span class="w">
        </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="mi">1407185953</span><span class="p">,</span><span class="w">
        </span><span class="s2">"read"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="s2">"created_by_user"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="s2">"user"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"is_admin"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="s2">"avatar"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"message_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"conversation"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"messages"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2006929</span><span class="p">,</span><span class="w">
                </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="mi">1407185953</span><span class="p">,</span><span class="w">
                </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"html"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;p&gt;User: {code:javascript}{}{code}\n&lt;br&gt;{quote}Просит добавить сервис: 'TEST_TEST_TEST'{quote}\n&lt;\/p&gt;"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"subject"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                </span><span class="s2">"from"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"is_admin"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"avatar"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="s2">"attachments"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"message_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2006929</span><span class="p">,</span><span class="w">
        </span><span class="s2">"thread_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2006929</span><span class="p">,</span><span class="w">
        </span><span class="s2">"interrupt"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Коды ошибок</p>

<ul>
<li><code class="prettyprint">missing_title</code> - не передан заголовок сервиса</li>
<li><code class="prettyprint">wallet_not_found</code> - кошелек с переданным номером телефона не найден</li>
</ul>
<h2 id='geografiya-naselennye-punkty'>География, населенные пункты</h2>
<p>Метод определяет населенный пункт пользователя по IP и возвращает список предустановленных (major) городов или результаты поиска по названию если параметры не переданы. Город, если определили автоматически, находится в <code class="prettyprint">meta.geo</code>.</p>

<p>Параметры:</p>

<ul>
<li><code class="prettyprint">filter_by</code> - использовать фильтр, поддерживается: <code class="prettyprint">title</code>. Не обязательно.</li>
<li><code class="prettyprint">title</code> - подстрока, входящая (в любом месте) в название населенного пункта, работает вместе с <code class="prettyprint">filter_by=title</code>. Не обязательно.</li>
</ul>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u +79261111111:p@ssw0rD http://sandbox.wallet.best/v1/geo?filter_by<span class="o">=</span>title<span class="se">\&amp;</span><span class="nv">title</span><span class="o">=</span>%D0%BC%D0%BE%D1%81%D0%BA%D0%B2
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"geo"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54be73b2b7f47bef910042b3"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Лобня"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"inside"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54be73b2b7f47bef910041e4"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Московская область"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54be73b2b7f47bef910041a8"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Центральный округ"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54be73b2b7f47bef910041a7"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Российская Федерация"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="s2">"urgent_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">2370</span><span class="p">,</span><span class="w">
            </span><span class="s2">"unseen_payments"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54be73b2b7f47bef910041ff"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Москва"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"inside"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54be73b2b7f47bef910041a8"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Центральный округ"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54be73b2b7f47bef910041a7"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Российская Федерация"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54be73b6b7f47bef9100a49a"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Москвина"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"inside"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54be73b6b7f47bef9100a493"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Кудымкарский район"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54be73b2b7f47bef910041fe"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Пермский край"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54be73b2b7f47bef910041ae"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Приволжский округ"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54be73b2b7f47bef910041a7"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Российская Федерация"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54be73b8b7f47bef9100be4a"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Москвитино"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"inside"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54be73b8b7f47bef9100be3b"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Свободненский район"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54be73b2b7f47bef910041d1"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Амурская область"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54be73b2b7f47bef910041ab"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Дальневосточный округ"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54be73b2b7f47bef910041a7"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Российская Федерация"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54be73b2b7f47bef9100436e"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Москвич"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"inside"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54be73b2b7f47bef91004365"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Домодедовский район"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54be73b2b7f47bef910041e4"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Московская область"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54be73b2b7f47bef910041a8"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Центральный округ"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54be73b2b7f47bef910041a7"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Российская Федерация"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

          <h1 id='platezhi'>Платежи</h1>
<p>Платеж - это операция движения денежных средств между счетами mserver выполняемая по распоряжению пользователя. Платежи различаются по типу:</p>

<table><thead>
<tr>
<th style="text-align: left">Тип платежа</th>
<th style="text-align: left">Описание</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code class="prettyprint">out</code></td>
<td style="text-align: left">Вывод средств со счета кошелька пользователя в пользу провайдера (провайдер КредитПилот)</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">p2p</code></td>
<td style="text-align: left">Перевод денег со счета кошелька пользователя на счет кошелька другого пользователя</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">in</code></td>
<td style="text-align: left">Ввод средств на счет кошелька пользователя через провайдера (провайдеры КредитПилот, ИПСП, Рапида)</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">inout</code></td>
<td style="text-align: left">Транзит средств от ИПСП в пользу КредитПилот</td>
</tr>
</tbody></table>

<p>Поля, общие для всех типов платежей</p>

<ul>
<li><code class="prettyprint">type</code> - in|out|p2p тип Платежа</li>
<li><code class="prettyprint">client_payment_id</code> - клиентский идентификатор (UUID)</li>
<li><code class="prettyprint">amount</code> - сумма к зачислению в рублях</li>
<li><code class="prettyprint">total</code> - полная сумма Платежа с учетом комиссии в рублях. Необязательное</li>
<li><code class="prettyprint">createdAt</code> - время создания</li>
<li><code class="prettyprint">processedAt</code> - время завершения online обработки</li>
<li><code class="prettyprint">status</code> - состояние</li>
<li><code class="prettyprint">decline_reason</code> - причина отказа в проведении</li>
</ul>

<p>Поля для платежей типа <code class="prettyprint">out</code> / <code class="prettyprint">inout</code> (вывод денег)</p>

<ul>
<li><code class="prettyprint">service</code> - назначение платежа</li>
<li><code class="prettyprint">outbound</code> - провайдер, на счет которого были отправлены деньги со счете кошелька</li>
<li><code class="prettyprint">parameters</code> - параметры платежа, например номер карты/телефона</li>
</ul>

<p>Поля для типа <code class="prettyprint">in</code> / <code class="prettyprint">inout</code> (ввод денег)</p>

<ul>
<li><code class="prettyprint">inbound</code> - провайдер, со счета которого деньги пришли на счет кошелька</li>
<li><code class="prettyprint">card</code> - карта с которой прошло пополнение</li>
</ul>

<p>Поля для типа <code class="prettyprint">p2p</code> (перевод между кошельками)</p>

<ul>
<li><code class="prettyprint">destination</code> - кошелек назначения перевода</li>
<li><code class="prettyprint">message</code> - сообщение адресату перевода</li>
</ul>
<h2 id='statusy-platezha'>Статусы платежа</h2>
<table><thead>
<tr>
<th style="text-align: left">Код статуса платежа</th>
<th style="text-align: left">Описание</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code class="prettyprint">created</code></td>
<td style="text-align: left">Платеж создан (например вызовом POST /payments) и ожидает от клиента команды на исполнение</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">processing</code></td>
<td style="text-align: left">Платеж был запущен в обработку (например вызовом POST /payments/{id}/pay и исполняется</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">completed</code></td>
<td style="text-align: left">Платеж успешно исполнен</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">declined</code></td>
<td style="text-align: left">Платеж отклонен, с уточнением причины в поле <code class="prettyprint">decline_reason</code></td>
</tr>
</tbody></table>
<h2 id='prichiny-otkaza-v-provedenii-platezha'>Причины отказа в проведении платежа</h2>
<table><thead>
<tr>
<th style="text-align: left">Код причины отказа</th>
<th style="text-align: left">Описание</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code class="prettyprint">invalid_data</code></td>
<td style="text-align: left">Неверные данные платежа (например неверный номер карты/номер телефона)</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">insufficient_funds</code></td>
<td style="text-align: left">Недостаточно средств на счете кошелька</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">internal_error</code></td>
<td style="text-align: left">Что-то пошло не так, обратитесь в поддержку</td>
</tr>
</tbody></table>
<h2 id='klientskiy-identifikator-platezha'>Клиентский идентификатор платежа</h2>
<p>Клиент обязан генерировать <a href="http://wikipedia.org/wiki/UUID">UUID</a> для каждого отдельного платежа и передавать его в поле <code class="prettyprint">client_payment_id</code> платежного запроса. По спецификации UUID должен быть в нижнем регистре (33b958e5-042b-4fb2-bf9e-e4198125e050). Если в процессе создания платежа клиент получил ошибку I/O, он должен повторять запрос создания платежа с тем же самым <code class="prettyprint">client_payment_id</code> до получения ответа. Гарантируется, что платеж с данным <code class="prettyprint">client_payment_id</code> будет создан не более 1 раза.</p>
<h2 id='provedenie-platezha'>Проведение платежа</h2>
<p>Для передачи mserver платежа на исполнение клиент следует общепринятому в платежной индустрии двухфазному протоколу. В первой фазе, подготовительной, клиент создает в mserver Платеж с необходимыми параметрами.
По завершении подготовительной фазы клиент получает от mserver информацию о полной стоимости платежа (поле <code class="prettyprint">total</code>) и предъявляет полную стоимость платежа пользователю кошелька.
В случае согласия пользователя с условиями исполнения платежа клиент от имени пользователя инициирует исполнение подготовленного платежа (вторая фаза, платежная).</p>

<p><img alt="проведение платежа" src="http://www.websequencediagrams.com/cgi-bin/cdraw?lz=dGl0bGUg0JTQstGD0YXRhNCw0LfQvdGL0Lkg0L_Qu9Cw0YLQtdC2AAoJ0YDQvtGC0L7QutC-0LsgbXNlcnZlcgoKbm90ZSBvdmVyIGNsaWVudCwAEwg6INCf0L7QtNCzADIHstC4AE8Fu9GM0LDRjyAAbQewCgoANAYtPgAxCVBPU1QgL3BheW1lbnRzIHtwYXJhbXN9AGcGcmlnaHQgb2YAYAkKAIEGCCDRgdC-0LfQtNCw0LXRggCBPA0sCiDRgNCw0YHRgdGH0LjRgtGL0LIAIAi60L7QvNC40YHRgdC40Y4KINC90LjQutGC0L4AAwiD0LTQsCDQtdGJ0LUg0L3QtQCCHQq40YIKZW5kIG5vdGUKCgCCEwctPgCCCgY6IHtpZDogMTIzLCBhbW91bnQ6IDEwMCwgdG90YWw6IDExMCwgbmV4dF9hY3Rpb246IHBheX0AglEHbGVmAIFlBQBEBwog0LrQu9C40LXQvQCBWQa-0LrQsNC3AIFADL_QvgCCXgW3AIJuBQCDQQa70Y4gCgAUB9C90YPRjiDRgQCDSQW40LzQvtGB0YLRjACDag6wIDExMCDRgAoAOheMAIJnBrMAhCYFgdC10L0AggQN0YwAgggLAIQGHgCEYQsAg2ouLzEyMy9wYXkAg3YhAFQFh9C40L0AhBAJ0YAAhQ0FvtC0AIEoBgCFaA0AgloO0YMAhXkGtdC00LvQsNCzAIRYBtGB0Y8g0L4AhhUFsNGI0LgAgmgG0YwKAIUCBQCCWgbRjwCERQUAhCILAIJXBQCEJQoAhBwSAIN_DWdldH0Ahg0TR0UAgXgPAIRjE3N0YXR1czogY29tcGxldGVkAIY4BwCEMSO70YPRhwCGPQcAgSshIAoAWQogKNC40YEAhGAI0LXQvSkKIFlheSEAhhcJ&amp;s=modern-blue" /></p>
<h3 id='platezh-v-polzu-servisa'>Платеж в пользу сервиса</h3>
<p>Параметры:</p>

<ul>
<li><code class="prettyprint">type</code> = <strong>out</strong> - тип платежа</li>
<li><code class="prettyprint">client_payment_id</code> - клиентский идентификатор платежа</li>
<li><code class="prettyprint">amount</code> -  сумма к зачислению</li>
<li><code class="prettyprint">service</code> - назначение платежа, идентификатор Сервиса</li>
<li><code class="prettyprint">parameters</code> - параметры платежного запроса в соответствии с /services/{service}</li>
</ul>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span>
 -d <span class="s1">'{"type": "out", "client_payment_id": "e731a7e2-c553-4295-867e-1023359bee28",
 "amount": 100, "service": 61, "parameters": {"phoneNumber": "9267101283",
 "BIK": "044583151", "Name": "name", "SName": "sname", "Fam": "fam"}}'</span>
 http://sandbox.wallet.best/v1/payments
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="s2">"next_action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"update"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"time"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.376464</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1401089240377</span><span class="p">,</span><span class="w">
        </span><span class="s2">"client_payment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e731a7e2-c553-4295-867e-1023359bee28"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
        </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-08-05T15:09:37.832Z"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"out"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">61</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Мультибанк"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_disabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"min_length"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"max_length"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"pattern_desc"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"№ Телефона (10 цифр)"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"suggested_values"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"9267101283"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"9267101283"</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"service_param_pattern_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_changed"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BIK"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_disabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"min_length"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"max_length"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"pattern_desc"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"БИК"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"suggested_values"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"044583151"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"044583151"</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"service_param_pattern_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_changed"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Name"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_disabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"min_length"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"max_length"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"pattern_desc"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Имя Отправителя"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"suggested_values"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"name"</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"service_param_pattern_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_changed"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SName"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_disabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"min_length"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"max_length"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"pattern_desc"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Отчество Отправителя"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"suggested_values"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"sname"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"sname"</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"service_param_pattern_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_changed"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Fam"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_disabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"min_length"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"max_length"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"pattern_desc"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Фамилия Отправителя"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"suggested_values"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"fam"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"fam"</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"service_param_pattern_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_changed"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"outbound"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w">
            </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ТПР (провайдер)"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Коды ошибок</p>

<ul>
<li><code class="prettyprint">missing_type</code> - отсутствует обязательный параметр type</li>
<li><code class="prettyprint">missing_client_payment_id</code> - отсутствует обязательный параметр client_payment_id</li>
<li><code class="prettyprint">missing_amount</code> - отсутствует обязательный параметр amount</li>
<li><code class="prettyprint">invalid_amount</code> - неверная сумма платежа, должно быть min &lt;= amount &lt;= max, где min и max - минимальная и максимальная сумма для Сервиса</li>
<li><code class="prettyprint">missing_service</code> - отсутствует обязательный параметр service</li>
<li><code class="prettyprint">service_not_found</code> - запрошенный сервис не найдет</li>
<li><code class="prettyprint">missing_parameters</code> - не передан обязательный параметр parameters</li>
</ul>
<h3 id='perevod-mezhdu-koshelkami'>Перевод между кошельками</h3>
<p>Параметры:</p>

<ul>
<li><code class="prettyprint">type</code> = <strong>p2p</strong> - тип платежа</li>
<li><code class="prettyprint">client_payment_id</code> - клиентский идентификатор платежа</li>
<li><code class="prettyprint">amount</code> -  сумма перевода</li>
<li><code class="prettyprint">destination</code> - кошелек назначения перевода</li>
<li><code class="prettyprint">message</code> - сообщение адресату перевода (опционально)</li>
</ul>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span>
 -d <span class="s1">'{"type": "p2p", "client_payment_id": "071c6d23-7508-4e35-ad92-852308a47677", "amont": 100,
 "destination": "+79261111112", "message": "Съешь ещё этих мягких французских булок, да выпей чаю"}'</span>
 http://sandbox.wallet.best/v1/payments
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pay"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089237211</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"071c6d23-7508-4e35-ad92-852308a47677"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">100.00</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-01T06:30:01.277Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"p2p"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"destination"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111112"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"message"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Съешь ещё этих мягких французских булок, да выпей чаю"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Коды ошибок</p>

<ul>
<li><code class="prettyprint">missing_type</code> - отсутствует обязательный параметр type</li>
<li><code class="prettyprint">missing_client_payment_id</code> - отсутствует обязательный параметр client_payment_id</li>
<li><code class="prettyprint">missing_amount</code> - отсутствует обязательный параметр amount</li>
<li><code class="prettyprint">invalid_amount</code> - сумма перевода должна быть &gt; 0</li>
<li><code class="prettyprint">missing_destination</code> - отсутствует обязательный параметр destination</li>
<li><code class="prettyprint">destination_not_found</code> - кошелек назначения платежа не найден</li>
<li><code class="prettyprint">invalid_destination</code> - попытка отправить p2p перевод самому себе</li>
<li><code class="prettyprint">insufficient_funds</code> - недостаточно средств для выполнения p2p перевода</li>
</ul>
<h3 id='popolnenie-koshelka'>Пополнение кошелька</h3>
<p>Пополнение кошелька пользователя через запросы к API возможно с использованием пластиковых карт. Существуют 3 сценария пополнения кошелька с карты:</p>

<ul>
<li>однократное пополнение</li>
<li>однократное пополнение с сохранением данных карты для последующего использования (&ldquo;привязка карты&rdquo;)</li>
<li>пополнение с сохраненной ранее карты (&ldquo;рекарринг&rdquo;)</li>
</ul>

<p>Параметры:</p>

<ul>
<li><code class="prettyprint">type</code> = <strong>in</strong> - тип платежа</li>
<li><code class="prettyprint">client_payment_id</code> - клиентский идентификатор платежа</li>
<li><code class="prettyprint">amount</code> -  сумма к зачислению</li>
<li>&lsquo;store_card&rsquo; - true|false - сохранить карту, чтобы использовать ее для платежей в дальнейшем (опциональный)</li>
<li><code class="prettyprint">card</code> - идентификатор сохраненной карты с которой будут списаны деньги (опциональный)</li>
</ul>

<p>Пример однократного пополнения</p>

<p>Создаем платеж:</p>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u +79261111111:password -H <span class="s1">'Content-type:application/json'</span> -d <span class="s1">'{"type": "in", "client_payment_id": "071c6d23-7508-4e35-ad92-852308a47678", "amount": 100}'</span> http://sandbox.wallet.best/v1/payments
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pay"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089237212</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"071c6d23-7508-4e35-ad92-852308a47678"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">100.00</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-01T06:55:27.870Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Платим:</p>
<pre class="highlight shell"><code><span class="nv">$curl</span> -u +79261111111:password -H <span class="s1">'Content-type:application/json'</span> -X POST http://sandbox.wallet.best/v1/payments/1401089237212/pay
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"get"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089237212</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"071c6d23-7508-4e35-ad92-852308a47678"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-01T06:55:27.870Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"processing"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pending"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"payment_page_url"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://test1.ipsp.com/frontend/endpoint?product_id=1721&amp;desc=mserver2&amp;payment_type=S&amp;amount=100.00&amp;currency=RUB&amp;cf=1401089237212&amp;locale=ru&amp;hash=3d49fa2b7ceb67f8ad7ed7f2247dd2cad1c4acdc"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>далее следует перенаправить пользователя на платежную страницу по ссылке из поля <code class="prettyprint">card.payment_page_url</code>.</p>

<p>Пример однократного пополнения с сохранением данных карты</p>

<p>Создаем платеж:</p>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u +79261111111:password -H <span class="s1">'Content-type:application/json'</span> -d <span class="s1">'{"type": "in", "client_payment_id": "071c6d23-7508-4e35-ad92-852308a47679", "amount": 100, "store_card": true}'</span> http://sandbox.wallet.best/v1/payments
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pay"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089237231</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"071c6d23-7508-4e35-ad92-852308a47679"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">100.00</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-01T08:31:24.058Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Платим:</p>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u +79261111111:password -H <span class="s1">'Content-type:application/json'</span> -X POST http://sandbox.wallet.best/v1/payments/1401089237231/pay
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"get"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089237231</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"071c6d23-7508-4e35-ad92-852308a47679"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-01T08:31:24.058Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"processing"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pending"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"payment_page_url"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://test1.ipsp.com/frontend/endpoint?product_id=1721&amp;desc=mserver2&amp;payment_type=S&amp;amount=100.00&amp;currency=RUB&amp;cf=1401089237231&amp;locale=ru&amp;biller_client_id=21&amp;perspayee_expiry=0150&amp;recur_freq=1&amp;hash=5136f2cb7fd77f98b1df86d4644338e5a10dab98"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>далее следует перенаправить пользователя на платежную страницу по ссылке из поля <code class="prettyprint">card.payment_page_url</code>.</p>

<p>Убедимся, что платеж успешен и карта сохранена:</p>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u +79261111111:password http://sandbox.wallet.best/v1/payments/1401089237231
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089237231</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"071c6d23-7508-4e35-ad92-852308a47679"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-01T08:31:24.058Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"processed_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-01T08:39:40.173Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"completed"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******2399"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Пример пополнения с сохраненной карты</p>

<p>Используем карту #21 сохраненную в предыдущем примере.</p>

<p>Создаем платеж:</p>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u +79261111111:password -H <span class="s1">'Content-type:application/json'</span> -d <span class="s1">'{"type": "in", "client_payment_id": "071c6d23-7508-4e35-ad92-852308a47689", "amount": 100, "card": 21}'</span> http://sandbox.wallet.best/v1/payments
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pay"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089237232</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"071c6d23-7508-4e35-ad92-852308a47653"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">100.00</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-01T08:58:51.143Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******2399"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Платим:</p>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span> -X POST http://sandbox.wallet.best/v1/payments/1401089237232/pay
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"get"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089237232</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"071c6d23-7508-4e35-ad92-852308a47653"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-01T12:04:49.330Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"processing"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******2399"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='tranzitnyy-platezh'>Транзитный платеж</h2>
<p>Транзитный платеж соединяет в одном действии зачисление денег на кошелек через поставщика ввода средств (в настоящее время ИПСП) и списание денег со счета кошелька в пользу поставщика вывода средств (в настоящее время КредитПилот).</p>

<p>По аналогии с пополнением кошелька возможны следующие варианты транзитного платежа:</p>

<ul>
<li>однократное списание с карты</li>
<li>однократное списание с карты с сохранением данных карты для последующего использования (“привязка карты”)</li>
<li>списание средств с сохраненной ранее карты (“рекарринг”)</li>
</ul>

<p>Параметры:</p>

<ul>
<li><code class="prettyprint">type</code> = <strong>inout</strong> - тип платежа</li>
<li><code class="prettyprint">client_payment_id</code> - клиентский идентификатор платежа</li>
<li><code class="prettyprint">amount</code> - сумма к зачислению</li>
<li><code class="prettyprint">service</code> - назначение платежа, идентификатор Сервиса</li>
<li><code class="prettyprint">parameters</code> - параметры платежного запроса в соответствии с /services/{service_id}</li>
<li><code class="prettyprint">card</code> - идентификатор сохраненной карты с которой будут списаны деньги (опциональный)</li>
<li><code class="prettyprint">store_card</code> - <strong>true | false</strong> - сохранить карту, чтобы использовать ее для платежей в дальнейшем (опциональный)</li>
</ul>
<h3 id='odnokratnoe-spisanie-s-karty'>Однократное списание с карты</h3>
<p>Создаем платеж:</p>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span>
-d <span class="s1">'{"type": "inout", "client_payment_id": "021c6d23-7508-4e35-ad92-852308a47689", "amount": 100, "service": 834,
"parameters": {"phoneNumber": "9267101283"}}'</span>
http://sandbox.wallet.best/v1/payments
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="s2">"urgent_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">9999</span><span class="p">,</span><span class="w">
            </span><span class="s2">"unseen_payments"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"next_action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pay"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"time"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.418221</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">25778</span><span class="p">,</span><span class="w">
        </span><span class="s2">"client_payment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"021c6d23-7508-4e35-ad92-852308a47689"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
        </span><span class="s2">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">103</span><span class="p">,</span><span class="w">
        </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-03-17T13:49:13.394Z"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"inout"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">834</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Мегафон"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_disabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="s2">"min_length"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
                </span><span class="s2">"max_length"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
                </span><span class="s2">"range_start"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">"range_end"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">"patterns"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                </span><span class="s2">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^\\+7[0-9]{10}$"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"pattern_desc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Номер телефона РФ начиная с +7 (в международном формате). Например, +79261112233"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phone"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Номер телефона, начиная с +7"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"default_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"suggested_values"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"localized_fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"pattern_desc"</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+79267101283"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"inbound"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
            </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"outbound"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Кредит Пилот"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"card"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"wallet"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Платим:
<code class="prettyprint">shell
curl -u+79261111111:password -H &#39;Content-type:application/json&#39; -X POST http://sandbox.wallet.best/v1/payments/25818/pay
</code></p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="s2">"next_action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"get"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"time"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.317098</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">25818</span><span class="p">,</span><span class="w">
        </span><span class="s2">"client_payment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"131c6d23-7508-4e35-ad92-852308a47689"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
        </span><span class="s2">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">103</span><span class="p">,</span><span class="w">
        </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-03-17T15:03:41.606Z"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"processing"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"inout"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">834</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Мегафон"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"№ Телефона"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9267101283"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"inbound"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
            </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"outbound"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Кредит Пилот"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"card"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pending"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"payment_page_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https:\/\/test1.ipsp.com\/frontend\/endpoint?product_id=1721&amp;desc=TestWallet&amp;payment_type=S&amp;amount=103.00&amp;currency=RUB&amp;cf=25818&amp;locale=ru&amp;hash=afbe9967151306a3e69900d5e3bffd7b5ef8475c"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"wallet"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Далее следует перенаправить пользователя на платежную страницу по ссылке из поля <code class="prettyprint">card.payment_page_url</code></p>
<h3 id='s-sohraneniem-dannyh-karty'>С сохранением данных карты</h3>
<p>Сценарий ничем не отличается от предыдущего, кроме передачи флага <code class="prettyprint">store_card</code> = <strong>true</strong> при создании платежа.
Идентификатор карты, возвращенный в <code class="prettyprint">data.card.id</code> можно впоследствии использовать для пополнения счета кошелька или выполнения транзитных платежей с сохраненной карты.</p>

<p>Создаем платеж:
<code class="prettyprint">shell
$ curl -u+79261111111:password -H &#39;Content-type:application/json&#39;
-d &#39;{&quot;type&quot;: &quot;inout&quot;, &quot;client_payment_id&quot;: &quot;021c6d23-7508-4e35-ad92-852308a47689&quot;, &quot;amount&quot;: 100, &quot;store_card&quot;: true,
&quot;service&quot;: 834, &quot;parameters&quot;: {&quot;phoneNumber&quot;: &quot;9267101283&quot;}}&#39;
http://sandbox.wallet.best/v1/payments
</code></p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="s2">"urgent_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">9999</span><span class="p">,</span><span class="w">
            </span><span class="s2">"unseen_payments"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"next_action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pay"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"time"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.330981</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">25778</span><span class="p">,</span><span class="w">
        </span><span class="s2">"client_payment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"021c6d23-7508-4e35-ad92-852308a47689"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
        </span><span class="s2">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">103</span><span class="p">,</span><span class="w">
        </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-03-17T13:49:13.394Z"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"inout"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">834</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Мегафон"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_disabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="s2">"min_length"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
                </span><span class="s2">"max_length"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
                </span><span class="s2">"range_start"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">"range_end"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">"patterns"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                </span><span class="s2">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^\\+7[0-9]{10}$"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"pattern_desc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Номер телефона РФ начиная с +7 (в международном формате). Например, +79261112233"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phone"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Номер телефона, начиная с +7"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"default_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"suggested_values"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"localized_fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"pattern_desc"</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+79267101283"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"inbound"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
            </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"outbound"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Кредит Пилот"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"card"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"wallet"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Платим:
<code class="prettyprint">shell
curl -u+79261111111:password -H &#39;Content-type:application/json&#39; -X POST http://sandbox.wallet.best/v1/payments/25818/pay
</code></p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="s2">"next_action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"get"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"time"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.317098</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">25818</span><span class="p">,</span><span class="w">
        </span><span class="s2">"client_payment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"131c6d23-7508-4e35-ad92-852308a47689"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
        </span><span class="s2">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">103</span><span class="p">,</span><span class="w">
        </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-03-17T15:03:41.606Z"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"processing"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"inout"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">834</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Мегафон"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"№ Телефона"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9267101283"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"inbound"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
            </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"outbound"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Кредит Пилот"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">7222</span><span class="p">,</span><span class="w">
            </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******6825"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"wallet"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h3 id='c-sohranennoy-karty'>C сохраненной карты</h3>
<p>Транзитный платеж с сохраненной карты отличается от платежа с однократным списанием только указанием идентификатора карты в поле <code class="prettyprint">card</code> при создании платежа.</p>

<p>Создаем платеж:
<code class="prettyprint">shell
$ curl -u+79261111111:password -H &#39;Content-type:application/json&#39;
-d &#39;{&quot;type&quot;: &quot;inout&quot;, &quot;client_payment_id&quot;: &quot;021c6d23-7508-4e35-ad92-852308a47689&quot;, &quot;amount&quot;: 100, &quot;card&quot;: 21, &quot;service&quot;: 834,
&quot;parameters&quot;: {&quot;phoneNumber&quot;: &quot;9267101283&quot;}}&#39;
http://sandbox.wallet.best/v1/payments
</code></p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="s2">"urgent_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">9999</span><span class="p">,</span><span class="w">
            </span><span class="s2">"unseen_payments"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"next_action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pay"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"time"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.32556</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">25778</span><span class="p">,</span><span class="w">
        </span><span class="s2">"client_payment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"021c6d23-7508-4e35-ad92-852308a47689"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
        </span><span class="s2">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">103</span><span class="p">,</span><span class="w">
        </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-03-17T13:49:13.394Z"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"inout"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">834</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Мегафон"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_disabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="s2">"min_length"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
                </span><span class="s2">"max_length"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
                </span><span class="s2">"range_start"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">"range_end"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">"patterns"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                </span><span class="s2">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^\\+7[0-9]{10}$"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"pattern_desc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Номер телефона РФ начиная с +7 (в международном формате). Например, +79261112233"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phone"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Номер телефона, начиная с +7"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"default_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"suggested_values"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"localized_fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"pattern_desc"</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+79267101283"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"inbound"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
            </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"outbound"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Кредит Пилот"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="w">
            </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******6825"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"wallet"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h3 id='otlozhennyy-vybor-tipa-platezha'>Отложенный выбор типа платежа</h3>
<p>Пользователь может отложить выбор типа платежа между out и inout до подтверждения платежа. Платеж может быть создан, как платеж со счета кошелька out, затем, если клиент передумал и решил заплатить картой, при подтверждении платежа вызовом</p>

<p><em>POST /payments/{:id}/pay</em></p>

<p>нужно передать в теле запроса следующие поля:</p>

<p>Поля запроса подтверждения платежа для смены типа <strong>in</strong> -&gt; <strong>inout</strong></p>

<ul>
<li><code class="prettyprint">type</code> = <strong>inout</strong> - тип платежа</li>
<li><code class="prettyprint">store_card</code> - true | false - сохранить карту, чтобы использовать ее для платежей в дальнейшем (опциональный)</li>
<li><code class="prettyprint">card</code> - идентификатор сохраненной карты с которой будут списаны деньги (опциональный)</li>
</ul>

<p>Создаем платеж используя кошелек как источник средств:</p>
<pre class="highlight shell"><code>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span>
-d <span class="s1">'{"type": "out", "amount": 100, "client_payment_id": "021c6d23-7508-4e35-ad92-852308a47689", "service": 834, "parameters": {"phoneNumber": "9267101283"}}'</span>
http://sandbox.wallet.best/v1/payments
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="s2">"urgent_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">9999</span><span class="p">,</span><span class="w">
            </span><span class="s2">"unseen_payments"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"next_action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pay"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"time"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.468765</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">25832</span><span class="p">,</span><span class="w">
        </span><span class="s2">"client_payment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"221c6d23-7508-4e35-ad92-852308a47689"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
        </span><span class="s2">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">103</span><span class="p">,</span><span class="w">
        </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-03-18T12:40:02.248Z"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"out"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">834</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Мегафон"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_disabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="s2">"min_length"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
                </span><span class="s2">"max_length"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
                </span><span class="s2">"range_start"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">"range_end"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">"patterns"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                </span><span class="s2">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^\\+7[0-9]{10}$"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"pattern_desc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Номер телефона РФ начиная с +7 (в международном формате). Например, +79261112233"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phone"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Номер телефона, начиная с +7"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"default_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"suggested_values"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"localized_fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"pattern_desc"</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+79267101283"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"outbound"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Кредит Пилот"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"wallet"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Решаем заплатить сохраненной картой с ID 7222:</p>
<pre class="highlight shell"><code>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span>
-d <span class="s1">'{"type": "inout", "card": 7222}'</span>
http://sandbox.wallet.best/v1/payments/25832/pay
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="s2">"next_action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"get"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"time"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.317098</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">25818</span><span class="p">,</span><span class="w">
        </span><span class="s2">"client_payment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"131c6d23-7508-4e35-ad92-852308a47689"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
        </span><span class="s2">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">103</span><span class="p">,</span><span class="w">
        </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-03-17T15:03:41.606Z"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"processing"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"inout"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">834</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Мегафон"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_disabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="s2">"min_length"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
                </span><span class="s2">"max_length"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
                </span><span class="s2">"range_start"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">"range_end"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">"patterns"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                </span><span class="s2">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^\\+7[0-9]{10}$"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"pattern_desc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Номер телефона РФ начиная с +7 (в международном формате). Например, +79261112233"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phone"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Номер телефона, начиная с +7"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"default_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"suggested_values"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"localized_fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"pattern_desc"</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+79267101283"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"inbound"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
            </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"outbound"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Кредит Пилот"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">7222</span><span class="p">,</span><span class="w">
            </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******6825"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"wallet"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='poluchenie-istorii-platezhey'>Получение истории платежей</h2>
<p>Сервис может быть выключеным, но в момент проведения транзакции был активен. Такой сервис будет помечен флагом <code class="prettyprint">is_disabled</code>
<code class="prettyprint">shell
$ curl -u +79261111111:password -H &#39;Content-type:application/json&#39; http://sandbox.wallet.best/v1/payments?page=0&amp;size=35
</code></p>

<p>Параметры <code class="prettyprint">page</code> и <code class="prettyprint">size</code> в запросе позволяют задать номер (начиная с 0) и размер страницы, которую запрашивает клиент. По умолчанию номер страницы - 0 и размер страницы - 35 платежей. Опциона��ьные параметры <code class="prettyprint">type</code> и <code class="prettyprint">status</code> позволяют фильтровать платежи по типу и статусу. По умолчанию, платежи со статусом <code class="prettyprint">created</code> не попадают в список, чтобы их увидеть, необходимо задать этот статус явно. Статусы и типы можно перечислять через запятую, например: <code class="prettyprint">status=created,completed</code>.</p>

<p>Если платеж еще не был просмотрен, у него будет поле <code class="prettyprint">unseen</code> со зачением <strong>true</strong>
Просмотренным платеж считается, когда он вернулся в списке. Если же платеж присутствует на второй странице выписки, а она не была запрошена - платеж будет считаться непросмотренным </p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="s2">"urgent_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mf">9971.34</span><span class="p">,</span><span class="w">
            </span><span class="s2">"unseen_payments"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"page"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"total_elements"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1401089244809</span><span class="p">,</span><span class="w">
            </span><span class="s2">"client_payment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"495e4210-18bc-4301-b388-5dda972865e6"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
            </span><span class="s2">"total"</span><span class="p">:</span><span class="w"> </span><span class="mf">8.03</span><span class="p">,</span><span class="w">
            </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-10-30T14:21:12.406Z"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"processed_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-10-30T14:21:20.309Z"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"completed"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"out"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Мегафон"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_disabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"№ телефона (10 цифр)"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9263456782"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="s2">"outbound"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w">
                </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ТПР (провайдер)"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"wallet"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+380631345678"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"remote_check"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1414678875803"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"subtitle"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"unseen"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1401089244494</span><span class="p">,</span><span class="w">
            </span><span class="s2">"client_payment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"df9180aa-a359-420d-8f3c-009a1bb8fac6"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">55</span><span class="p">,</span><span class="w">
            </span><span class="s2">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">55</span><span class="p">,</span><span class="w">
            </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-10-27T16:09:26.058Z"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"processed_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-10-27T16:09:28.936Z"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"completed"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"inbound"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
                </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"card"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2727</span><span class="p">,</span><span class="w">
                </span><span class="s2">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******9149"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"wallet"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+380631345678"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1401089244492</span><span class="p">,</span><span class="w">
            </span><span class="s2">"client_payment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"087a9555-d25b-400c-af5b-ef1c5a99b145"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w">
            </span><span class="s2">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">1015</span><span class="p">,</span><span class="w">
            </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-10-27T16:07:34.282Z"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"processed_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-10-27T16:07:47.922Z"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"completed"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"out"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
                </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Яндекс.Деньги"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_disabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"№ счёта (1-32 цифры):"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"55855555"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="s2">"outbound"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w">
                </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ТПР (провайдер)"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"wallet"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+380631345678"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"remote_check"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1414426063287"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"subtitle"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1401089244493</span><span class="p">,</span><span class="w">
            </span><span class="s2">"client_payment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a0449e92-a853-4a80-bc47-11b453c54ab9"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">1015</span><span class="p">,</span><span class="w">
            </span><span class="s2">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">1015</span><span class="p">,</span><span class="w">
            </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-10-27T16:07:37.952Z"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"processed_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-10-27T16:07:39.822Z"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"completed"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"inbound"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
                </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"card"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2727</span><span class="p">,</span><span class="w">
                </span><span class="s2">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******9149"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"wallet"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+380631345678"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1401089244491</span><span class="p">,</span><span class="w">
            </span><span class="s2">"client_payment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54851a0b-4b60-4497-ab94-7f1b49eb9db0"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w">
            </span><span class="s2">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">1015</span><span class="p">,</span><span class="w">
            </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-10-27T16:05:57.109Z"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"processed_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-10-27T16:05:57.264Z"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"declined"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"decline_reason"</span><span class="p">:</span><span class="w"> </span><span class="s2">"invalid_data"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"out"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w">
                </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Триколор ТВ"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"is_disabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"578"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Тип платежа"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"588255585"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"№ агент.договора или приёмного оборудования (1-14 цифр)"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"588255585"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="s2">"outbound"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w">
                </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ТПР (провайдер)"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"wallet"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+380631345678"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"subtitle"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='sbros-schetchika-neprosmotrennyh-platezhey'>Сброс счетчика непросмотренных платежей</h2>
<p>Возможно обнулить счетчик непросмотренных платежей</p>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u +79261111111:password -H <span class="s1">'Content-type:application/json'</span> http://sandbox.wallet.best/v1/payments/reset_unseen
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="s2">"urgent_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">9862</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='uvedomleniya-ob-izmenenii-statusa-platezha'>Уведомления об изменении статуса платежа</h2>
<p>Для уведомления внешней системы об изменениях статуса платежа mserver выполняет POST запрос на URL указанный в настройках проекта.
Для авторизации запрос должен содержать <code class="prettyprint">app_id</code> и <code class="prettyprint">access_token</code> ( результат <code class="prettyprint">sha1( app_id + app_secret )</code>.
Уведомление передается в теле POST запроса в виде объекта платежной операции сериализованного в JSON. Например:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-08-02T14:37:20.102Z"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"payment"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089240253</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"a02b1416-b9c1-4782-88c5-da4d78b32f8d"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-08-02T14:36:02.997Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"processed_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-08-02T14:37:20.102Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"completed"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"used"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******2399"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"from"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"processing"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"to"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"completed"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"complete"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Поля</p>

<ul>
<li><code class="prettyprint">created_at</code> - момент времени совершения платежной операции</li>
<li><code class="prettyprint">payment</code> - стандартное представление объекта платежа описанное выше</li>
<li><code class="prettyprint">from</code> - начальный статус платежа</li>
<li><code class="prettyprint">to</code> - конечный статус платежа</li>
<li><code class="prettyprint">type</code> - тип платежной операции, см. ниже</li>
</ul>

<p>Типы платежных операций</p>

<table><thead>
<tr>
<th style="text-align: left">Тип</th>
<th style="text-align: left">Описание</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code class="prettyprint">complete</code></td>
<td style="text-align: left">Платеж проведен</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">decline</code></td>
<td style="text-align: left">Платеж отклонен</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">undo</code></td>
<td style="text-align: left">Отмена ранее успешного платежа (сторно)</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">redo</code></td>
<td style="text-align: left">Ранее отмененный платеж сделан успешным (сторно сторно and we need to go deeper)</td>
</tr>
</tbody></table>

          <h1 id='karty'>Карты</h1>
<p>Карта - это сохраненный в mserver токен, с помощью которого пользователь кошелька может пополнять счет без ввода данных пластиковой карты.</p>

<p>Поля</p>

<ul>
<li><code class="prettyprint">id</code> - уникальный идентификатор карты</li>
<li><code class="prettyprint">state</code> - состояние карты, см. ниже</li>
<li><code class="prettyprint">title</code> - название карты, в качестве названия сейчас используется маскированный номер карты</li>
<li><code class="prettyprint">type</code> - бренд карты: Visa/MasterCard/&hellip;</li>
</ul>

<p>Состояния карты</p>

<table><thead>
<tr>
<th style="text-align: left">Код состояния карты</th>
<th style="text-align: left">Описание</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code class="prettyprint">created</code></td>
<td style="text-align: left">Карта только что создана</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">pending</code></td>
<td style="text-align: left">Карта сохраняется (ожидается уведомление от IPSP о успехе/неуспехе карточной транзакции</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">active</code></td>
<td style="text-align: left">Карта сохранена, может быть использована для повторных платежей</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">failed</code></td>
<td style="text-align: left">Карта не сохранена (и уже не будет)</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">used</code></td>
<td style="text-align: left">Карта использована для однократного пополнения</td>
</tr>
</tbody></table>
<h2 id='sozdanie-karty'>Создание карты</h2>
<p>Параметры</p>

<ul>
<li><code class="prettyprint">card_success_url</code> - URL на который пользователь будет перенаправлен в случае успешного сохранения карты, опционально</li>
<li><code class="prettyprint">card_failure_url</code> - URL на который пользователь будет перенаправлен в случае неуспешного сохранения карты, опционально</li>
<li><code class="prettyprint">iframe</code> - опциональный параметр [true|false], который будет передаваться в payment_page_url </li>
</ul>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:p@ssw0rD -H <span class="s1">'Content-type:application/json'</span> -d <span class="s1">'{"card_success_url": "http://ya.ru", "card_failure_url": "http://google.com"}'</span> http://sandbox.wallet.best/v1/cards
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
    </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pending"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"payment_page_url"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://test1.ipsp.com/frontend/endpoint?product_id=1721&amp;desc=mserver2&amp;payment_type=A&amp;amount=1.00&amp;currency=RUB&amp;biller_client_id=1f95c7b9-74e5-4fd7-983d-c8d03d90347e&amp;perspayee_expiry=0150&amp;recur_freq=1&amp;locale=ru&amp;hash=cace0d7de544a25d2aa685ef12263a10655d9058"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>далее следует перенаправить пользователя на платежную страницу по ссылке из поля <code class="prettyprint">payment_page_url</code>. После ввода пользователем данных карты на платежной странице  и получения mserver уведомления от IPSP об успехе или неуспехе карточной транзакции карта перейдет в состояние <code class="prettyprint">active</code> или <code class="prettyprint">failed</code>.</p>

<p>Коды ошибок</p>

<ul>
<li><code class="prettyprint">active_cards_limit</code> - превышено максимально возможное количество активных карт</li>
</ul>
<h2 id='zagruzka-karty'>Загрузка карты</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:p@ssw0rD -H <span class="s1">'Content-type:application/json'</span> http://sandbox.wallet.best/v1/cards/62
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
    </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******2399"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Как видно, карта успешно сохранена и может быть использована для пополнения счета кошелька.</p>
<h2 id='poluchenie-spiska-kart'>Получение списка карт</h2>
<p>Опциональный параметр <code class="prettyprint">state</code> позволяет фильтровать карты по состоянию.</p>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:p@ssw0rD -H <span class="s1">'Content-type:application/json'</span> http://sandbox.wallet.best/v1/cards?state<span class="o">=</span>active,pending
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
    </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******2399"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='udalenie-karty'>Удаление карты</h2><pre class="highlight shell"><code><span class="gp">$ </span>сurl -u+79261111111:p@ssw0rD -H <span class="s1">'Content-type:application/json'</span>
 -X DELETE http://sandbox.wallet.best/v1/cards/62
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='dannye-testovyh-kart'>Данные тестовых карт</h2>
<table><thead>
<tr>
<th style="text-align: left">Номер карты</th>
<th style="text-align: right">Срок действия</th>
<th style="text-align: right">CVV2/CVC2</th>
<th style="text-align: center">3D-Secure</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">5417150893587260</td>
<td style="text-align: right">01/17</td>
<td style="text-align: right">082</td>
<td style="text-align: center">&#x2713;</td>
</tr>
<tr>
<td style="text-align: left">5417150396276825</td>
<td style="text-align: right">01/17</td>
<td style="text-align: right">789</td>
<td style="text-align: center">&#x2717;</td>
</tr>
<tr>
<td style="text-align: left">4652060573334999</td>
<td style="text-align: right">01/17</td>
<td style="text-align: right">067</td>
<td style="text-align: center">&#x2713;</td>
</tr>
<tr>
<td style="text-align: left">4652060724922338</td>
<td style="text-align: right">01/17</td>
<td style="text-align: right">989</td>
<td style="text-align: center">&#x2717;</td>
</tr>
</tbody></table>

<p>Пароль 3D-Secure: 123456.</p>

          <h1 id='poluchenie-spiska-geotochek'>Получение списка геоточек</h1>
<p>Список геоточек с возможностью фильтрации. Параметры запроса:</p>

<ul>
<li><code class="prettyprint">group</code> - фильтр по группе</li>
<li><code class="prettyprint">point</code> - координаты для получения точек в радиусе, формат: <strong>longitude,latitude</strong>. Пример:
<code class="prettyprint">shell
curl -u +12345675578:password http://sandbox.wallet.best/v1/locations?point=57.415033,51.446833
</code></li>
<li><code class="prettyprint">distance</code> - радиус площади в метрах, по-умолчанию 500. Работает только вместе с <strong>point</strong>. </li>
<li><code class="prettyprint">square</code> - получение точек в прямоугольном полигоне. Передать нужно две координаты - сначала левую верхнюю, затем правую нижнюю точки в формате: <strong>longitude,latitude,longitude,latitude</strong>. Пример:<br>
<code class="prettyprint">shell
curl -u +12345675578:password http://sandbox.wallet.best/v1/locations?square=57.279764,51.512689,57.415033,51.446833
</code></li>
</ul>
<h5 id='vnimanie-vsegda-peredavayte-kooridnaty-v-posledovatelnosti-stronglongitudelatitudestrong-a-ne-naoborot'>Внимание! Всегда передавайте коориднаты в последовательности <strong>longitude,latitude</strong>, а не наоборот</h5>
<p>Поля:</p>

<ul>
<li><code class="prettyprint">id</code> - уникальный идентификатор точки</li>
<li><code class="prettyprint">name</code> - наименование точки</li>
<li><code class="prettyprint">type</code> - <strong>офис | терминал | касса</strong></li>
<li><code class="prettyprint">group</code> - <strong>replenishment | verification | money_transfer</strong></li>
<li><code class="prettyprint">worktime</code> - время работы</li>
<li><code class="prettyprint">address</code> - адрес точки</li>
<li><code class="prettyprint">latitude</code> - широта точки</li>
<li><code class="prettyprint">longitude</code> - долгота точки</li>
</ul>

<p>Ошибки:</p>

<ul>
<li><code class="prettyprint">invalid_location_group</code> - неправильная группа</li>
<li><code class="prettyprint">missed_location_point_comma</code> - нет разделительной запятой между долготой и широтой для точки координат</li>
<li><code class="prettyprint">missed_location_square_comma</code> - нет разделительной запятой между долготой и широтой для координат в полигоне</li>
<li><code class="prettyprint">wrong_location_square_points_amount</code> - координат в полигоне должно быть ровно 4</li>
</ul>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u +12345675578:password http://sandbox.wallet.best/v1/locations
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54635060279871e2098b4567"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Точка пополнения 'Денег нет'"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Банкомат: Инвестбанк ОАО АКБ"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"replenishment"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"worktime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"пн-пт: 09:00-20:00, сб: 10:00-16:00"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Москва ул. Ворошилова 169-171"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"latitude"</span><span class="p">:</span><span class="w"> </span><span class="mf">55.616371</span><span class="p">,</span><span class="w">
            </span><span class="s2">"longitude"</span><span class="p">:</span><span class="w"> </span><span class="mf">37.211893</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54635060279871e2098b4568"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"За Казмадан!"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Касса: СЛАВИНВЕСТБАНК ООО"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"verification"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"worktime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"круглосуточно"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Москва ул. маршала Жукова 1"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"latitude"</span><span class="p">:</span><span class="w"> </span><span class="mf">55.676006</span><span class="p">,</span><span class="w">
            </span><span class="s2">"longitude"</span><span class="p">:</span><span class="w"> </span><span class="mf">37.252398</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

          <h1 id='limity'>Лимиты</h1><h2 id='limity-platezhey'>Лимиты платежей</h2><pre class="highlight shell"><code><span class="gp">$ </span>сurl -u+79261111111:p@ssw0rD -H <span class="s1">'Content-type:application/json'</span> http://sandbox.wallet.best/v1/limits
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="s2">"urgent_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">581</span><span class="p">,</span><span class="w">
            </span><span class="s2">"unseen_payments"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Максимальный остаток на счет"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Сумма сверх указанного лимита будет временно недоступна для любых операций"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"limits"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bool"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"anonymous"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"60000"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"verified"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bool"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"personified"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

          <h1 id='invoysy'>Инвойсы</h1><h2 id='statusy-invoysa'>Статусы инвойса</h2>
<table><thead>
<tr>
<th style="text-align: left">Код</th>
<th style="text-align: left">Описание</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code class="prettyprint">created</code></td>
<td style="text-align: left">Инвойс создан</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">canceled</code></td>
<td style="text-align: left">Инвойс отменен пользователем, который его создал</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">processing</code></td>
<td style="text-align: left">Инвойс был запущен в обработку методом /pay</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">completed</code></td>
<td style="text-align: left">Платеж по инвойсу успешно прошел</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">declined</code></td>
<td style="text-align: left">Платеж по инвойсу отклонен мсервером</td>
</tr>
</tbody></table>
<h2 id='sozdanie-invoysa'>Создание инвойса</h2>
<p>Поля</p>

<ul>
<li><code class="prettyprint">payer</code> - номер телефона, кто будет платить, на кого выставляется инвойс, обязательное поле</li>
<li><code class="prettyprint">amount</code> - сумма к оплате, обязательное поле</li>
<li><code class="prettyprint">message</code> - произвольный текст, необязательное поле</li>
</ul>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u +12345675578:password -H <span class="s1">'Content-type:application/json'</span> -d <span class="s1">'{"payer": "+12345678102", "amount": 350, "message": "Test invoice"}'</span> http://sandbox.wallet.best/v1/invoices
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
    </span><span class="p">},</span><span class="w">
</span><span class="err">}</span><span class="w">
</span></code></pre>

<p>Коды ошибок</p>

<ul>
<li><code class="prettyprint">missing_payer</code> - не указано, кто будет платить</li>
<li><code class="prettyprint">payer_not_exists</code> - нет такого пользователя</li>
<li><code class="prettyprint">invalid_payer</code> - нельзя выставлять счет самому себе</li>
<li><code class="prettyprint">missing_amount</code> - не указана сумма</li>
</ul>
<h2 id='spisok-invoysov-vystavlennyh-polzovatelyu'>Список инвойсов выставленных пользователю</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -u +12345675578:password http://sandbox.wallet.best/v1/invoices
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5422daccb7f47b52010041a7"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"payer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+12345675578"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
            </span><span class="s2">"recipient"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+12345678102"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"processing"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"payment_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5422dc24b7f47b52010041a8"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"payer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+12345675578"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w">
            </span><span class="s2">"recipient"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+12345678102"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Test invoice"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"completed"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"payment_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1401089242211</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5422dd02b7f47b52010041a9"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"payer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+12345675578"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w">
            </span><span class="s2">"recipient"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+12345678102"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Test invoice"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"payment_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='spisok-invoysov-kotorye-vystavil-polzovatel'>Список инвойсов, которые выставил пользователь</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -u +12345675578:password http://sandbox.wallet.best/v1/invoices/created
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5422cebeb7f47b53010041a7"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"payer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+12345671157"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
            </span><span class="s2">"recipient"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+12345675578"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"payment_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5422cf7cb7f47b54010041a7"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"payer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+12345671157"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">1050</span><span class="p">,</span><span class="w">
            </span><span class="s2">"recipient"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+12345675578"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"canceled"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"payment_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='povtorit-produblirovat-invoys'>Повторить (продублировать) инвойс</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -u +12345675578:password http://sandbox.wallet.best/v1/invoices/5422cf7cb7f47b54010041a7/duplicate
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"542423c7b7f47b58010041a8"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"payer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+12345671157"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">1050</span><span class="p">,</span><span class="w">
        </span><span class="s2">"recipient"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+12345675578"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"canceled"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"payment_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Коды ошибок</p>

<ul>
<li><code class="prettyprint">invalid_invoice</code> - нет такого инвойса</li>
</ul>
<h2 id='otmenit-invoys'>Отменить инвойс</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -u +12345675578:password http://sandbox.wallet.best/v1/invoices/5422cebeb7f47b53010041a7/cancel
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Коды ошибок</p>

<ul>
<li><code class="prettyprint">invoice_is_processing</code> - инвойс процессится, уже нельзя отменить</li>
<li><code class="prettyprint">invoice_is_completed</code> - инвойс выполнен, нет смысла отменять</li>
<li><code class="prettyprint">invoice_is_already_canceled</code> - инвойс был отменен ранее</li>
<li><code class="prettyprint">invoice_cancelling_error</code> - что-то пошло не так, при отмене инвойса</li>
<li><code class="prettyprint">invoice_not_found</code> - нет такого инвойса</li>
</ul>
<h2 id='oplatit-invoys'>Оплатить инвойс</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -u +12345675578:password -X POST http://sandbox.wallet.best/v1/invoices/5422dd02b7f47b52010041a9/pay
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
            </span><span class="s2">"next_action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pay"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"time"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.927491</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1401089242256</span><span class="p">,</span><span class="w">
            </span><span class="s2">"client_payment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a0341db9-280f-4daa-ad09-7f10e1dce5a5"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w">
            </span><span class="s2">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w">
            </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-09-25T14:26:47.406Z"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"p2p"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"wallet"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+12345675578"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"destination"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+12345678102"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"direction"</span><span class="p">:</span><span class="w"> </span><span class="s2">"out"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Test invoice"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Коды ошибок</p>

<ul>
<li><code class="prettyprint">invoice_is_processing</code> - уже запущен процесс оплаты для инвойса</li>
<li><code class="prettyprint">invoice_is_completed</code> - инвойс уже оплачен</li>
<li><code class="prettyprint">invoice_is_canceled</code> - инвойс был отменен пользователем, создавшим его</li>
<li><code class="prettyprint">invoice_is_declined</code> - оплата по инвойсу была отменена МСервером</li>
</ul>

          <h1 id='shablony-platezhey'>Шаблоны платежей</h1>
<p>Шаблоны платежей предназначены для платежей типа &lsquo;out&rsquo; для <a href="#services">сервисов</a>. Потому для создания платежа обязательно поле <code class="prettyprint">service_id</code></p>

<p>Поля шаблона</p>

<ul>
<li><code class="prettyprint">name</code> - имя шаблона</li>
<li><code class="prettyprint">type</code> - ** public | private**</li>
<li><code class="prettyprint">amount</code> - сумма платежа</li>
<li><code class="prettyprint">service_id</code> - id сервиса, обязательное поле при создании</li>
<li><code class="prettyprint">parameters</code> - массив с параметрами и их значением в формате: {param_id : param_value}</li>
<li><code class="prettyprint">disabled</code> - массив с id параметров, которые в форме шаблона нельзя изменить {&#39;phone&rsquo;, &#39;name&rsquo;}</li>
<li><code class="prettyprint">wallet</code> - объект <a href="#wallet">кошелька</a></li>
</ul>
<h2 id='sozdanie-shablonov'>Создание шаблонов</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -H <span class="s2">"Authorization: Bearer b48a991e-e010-4329-9817-f8389a774c45"</span> -H <span class="s1">'Content-type:application/json'</span>
-d <span class="s1">'{"name": "Template", "amount": 350, "type": "public", "service_id": 1000,
"parameters": {"phoneNumber": "+380509990088"}, "disabled": ["phoneNumber"]}'</span>
http://sandbox.wallet.best/v1/payments/templates
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="s2">"urgent_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">2370</span><span class="p">,</span><span class="w">
            </span><span class="s2">"unseen_payments"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54d23587a60ad674680041be"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='polucheniya-spiska-shablonov'>Получения списка шаблонов</h2>
<p>Список шаблонов с постраничной навигацией и возможностью фильтрации. Параметры запроса:</p>

<ul>
<li><code class="prettyprint">size</code> - кол-во элементов в списке (по-умолчанию 20)</li>
<li><code class="prettyprint">page</code> - страница списка</li>
<li><code class="prettyprint">type</code> - ** public | private**</li>
<li><code class="prettyprint">phone</code> - телефон кошелька</li>
<li><code class="prettyprint">service_id</code> - id сервиса</li>
</ul>
<h3 id='vazhno'>Важно!</h3>
<p>Если <em>type</em> не передан или <em>type</em> = <strong>private</strong>, то вернутся шаблоны только для авторизированного кошелька,
а переданный телефон в параметре <em>phone</em> будет проигнорирован</p>

<p>Если же нужно получить список по другим кошелькам - используйте тип <strong>public</strong></p>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -H <span class="s2">"Authorization: Bearer b48a991e-e010-4329-9817-f8389a774c45"</span> http://sandbox.wallet.best/v1/payments/templates
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="s2">"urgent_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">2370</span><span class="p">,</span><span class="w">
            </span><span class="s2">"unseen_payments"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54d23418a60ad674680041bd"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aloha"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"public"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w">
                </span><span class="s2">"disabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1690</span><span class="p">,</span><span class="w">
                </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ТСЖ Монолит-престиж"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"icon_url"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="s2">"limit"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                </span><span class="s2">"minsum"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                </span><span class="s2">"maxsum"</span><span class="p">:</span><span class="w"> </span><span class="mi">15000</span><span class="p">,</span><span class="w">
                </span><span class="s2">"verification_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="s2">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"address"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"is_disabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"is_hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"is_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"min_length"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"max_length"</span><span class="p">:</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"range_start"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"range_end"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"patterns"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                            </span><span class="p">{</span><span class="w">
                                </span><span class="s2">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                                </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
                            </span><span class="p">}</span><span class="w">
                        </span><span class="p">],</span><span class="w">
                        </span><span class="s2">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"pattern_desc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Введите ваш домашний адрес"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Адрес"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"default_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"suggested_values"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                        </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Мухосранск, ул. Выбитых окон, дом 1"</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="err">...</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"549c92fb56c35f660ecd341f"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Коммунальные услуги"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"icon_url_32x32"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
                    </span><span class="s2">"amount"</span><span class="err">:</span><span class="w"> </span><span class="mi">3</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="err">...</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='polucheniya-shablona-po-id'>Получения шаблона по id</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -H <span class="s2">"Authorization: Bearer b48a991e-e010-4329-9817-f8389a774c45"</span>
http://sandbox.wallet.best/v1/payments/templates/5422dd02b7f47b52010041a9
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="s2">"urgent_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">2370</span><span class="p">,</span><span class="w">
            </span><span class="s2">"unseen_payments"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54d23587a60ad674680041be"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="s2">"disabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ЖКУ Москва"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"icon_url"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="s2">"limit"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="s2">"minsum"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"maxsum"</span><span class="p">:</span><span class="w"> </span><span class="mi">15000</span><span class="p">,</span><span class="w">
            </span><span class="s2">"verification_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="s2">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"126"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"is_disabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"is_hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"is_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"min_length"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"max_length"</span><span class="p">:</span><span class="w"> </span><span class="mi">250</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"range_start"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"range_end"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"patterns"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                        </span><span class="p">{</span><span class="w">
                            </span><span class="s2">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                            </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
                        </span><span class="p">}</span><span class="w">
                    </span><span class="p">],</span><span class="w">
                    </span><span class="s2">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"pattern_desc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"от  3 до 250 символов"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Адрес проживания"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"default_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"suggested_values"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                    </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="err">...</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='izmenenie-shablona'>Изменение шаблона</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -H <span class="s2">"Authorization: Bearer b48a991e-e010-4329-9817-f8389a774c45"</span> -H <span class="s1">'Content-type:application/json'</span>
-d <span class="s1">'{"name": "Template", "amount": 350, "type": "public", "service_id": 1000,
"params": {"phoneNumber": "+380509990088"}, "disabled": ["phoneNumber"]}'</span>
http://sandbox.wallet.best/v1/payments/templates/5422dd02b7f47b52010041a9
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='udalenie-shablona'>Удаление шаблона</h2>
<p>Удалить можно только свои шаблоны
<code class="prettyprint">shell
$ curl -H &quot;Authorization: Bearer b48a991e-e010-4329-9817-f8389a774c45&quot; -X DELETE
http://sandbox.wallet.best/v1/payments/templates/5422dd02b7f47b52010041a9
</code></p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
