#Ошибки

API использует HTTP статусы для возврата ошибок.

| Статус                | Описание                               |
| :-------------------: |---------------------------------------------------------------------------------------------------------------|
| 200                   |  запрос выполнен успешно                                                                                      |
| 304                   |  документ не изменился с указанного момента                                                                   |
| 400                   |  плохо сформированный запрос (например невалидный JSON)                                                       |
| 401                   |  неверные учетные данные                                                                                      |
| 404                   |  запрошенный ресурс не существует (для запрашивающего)                                                        |
| 405                   |  не тот HTTP метод, например GET вместо POST                                                                  |
| 415                   |  не тот content-type, мы поддерживаем только application/json                                                 |
| 422                   |  запрос сформирован нормально, но не прошел валидацию, например не хватает полей или поле не в нужном формате |
| 5XX                   |  проблема с mserver, повторите запрос позже                                                                   |

HTTP статус дублируется в поле `meta.status` ответа mserver. В определенных случаях вместе со статусом возвращается уточненный код ошибки в поле `meta.error`. Например для невалидного номера телефона при создании кошелка возвращается

```json
{
  "meta" : {
    "code" : 422,
    "error" : "invalid_phone",
    "error_message": "Неверный телефон"
  }
}
```

## Получение ошибок API

Поля:

* `code` - идентификатор ошибки
* `title` - словарь с локализированными ошибками

Поле `title` может быть с динамическими данными, например `{{ object.meta.code }}` при получении реальной ошибки отдаст http код состояния

В ответе в *meta* присутствует параметр **request_time** со значением UNIX timestamp.
Если делать запрос с параметром **If-Modified-Since** в котором будет указан timestamp предыдущего запроса, то ответ может быть с HTTP кодом 304

```shell
$ curl http://sandbox.wallet.best/v1/errors
```

```json
{
    "meta": {
        "request_time": 1432652055,
        "code": 200
    },
    "data": [
        {
            "code": "wallet_not_found",
            "title": {
                "ru_RU": "кошелек не существует"
            }
        },
        {
            "code": "invalid_phone",
            "title": {
                "ru_RU": "требуется номер телефона в международном формате",
                "en_US": "invalid phone {{ object.meta.code }}"
            }
        }
    ]
}
```

Справочники возможных значений error для каждого вызова API описаны ниже.

## Meta

Любой успешный запрос с кошельком будет возвращать в поле `meta` следующие поля:

* `code` - код состояния HTTP
* `urgent_data` - массив с оперативной информацией:
  * `amount` - текущее кол-во денег в кошельке
  * `unseen_payments` - кол-во непросмотренных транзакций в логе

```json
{
    "meta": {
        "code": 200,
        "urgent_data": {
            "amount": 2370,
            "unseen_payments": 15
        }
    }
}
```

## Аутентификация

Используется [OAuth аутентификация](http://nebo15.github.io/mbank.docs/mserver.html#oauth). 
В качестве логина используется номер телефона Кошелька в международном формате. В случае, если кошелек не прошел аутентификацию, сервер вернет HTTP статус 401.

Коды ошибок

* `wallet_not_active` - кошелек не активирован
* `wallet_disabled` - заблокирован администрацией


#Настройки приложения

```shell
$ curl -u +79261111111:p@ssw0rD http://sandbox.wallet.best/v1/options
```

```json
{
    "meta": {
        "code": 200
    },
    "data": {
        "support_phone": "+380991032585",
        "mobile_operators_category_ids": {
            "ru": 3
        }
    }
}
```
