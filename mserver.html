<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Mserver API</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

  </head>

  <body class="mserver">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <!--<img src="images/logo.png" />-->
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='mserver.html'>Mserver API</a></li>
            <li><a href='mserver_admin.html'>Mserver Admin API</a></li>
            <li><a href='bestwallet.html'>BestWallet API</a></li>
            <li><a href='bw_admin.html'>BestWallet Admin API</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        
          <h1 id='vvedenie'>Введение</h1>
<p>API mserver использует подход <a href="http://wikipedia.org/wiki/REST">REST</a>. Клиенты API получают доступ к Кошельку, Сервисам, Платежам и Картам выполняя <code class="prettyprint">GET</code>, <code class="prettyprint">POST</code> и <code class="prettyprint">DELETE</code> запросы к соответствующим ресурсам <code class="prettyprint">/wallet</code>, <code class="prettyprint">/services</code>, <code class="prettyprint">/payments</code> и <code class="prettyprint">/cards</code>. 
Вызовы API всегда возвращают JSON. Для возврата статуса запроса к API используется код состояния HTTP. </p>
<h2 id='autentifikatsiya'>Аутентификация</h2>
<p>Используется <a href="http://wikipedia.org/wiki/Basic_access_authentication">BASIC аутентификация</a>. В качестве логина используется номер телефона Кошелька в международном формате.</p>

<p>Возможны следующие коды ошибок, уточняющие HTTP статус 401:</p>

<table><thead>
<tr>
<th>Код ошибки</th>
<th style="text-align: left">Описание</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">wallet_not_active</code></td>
<td style="text-align: left">Кошелек не активирован. Активируйте кошелек вызовом POST /wallet/activate.</td>
</tr>
<tr>
<td><code class="prettyprint">wallet_disabled</code></td>
<td style="text-align: left">Кошелек заблокирован администрацией. Причина блокировки возвращается в поле <code class="prettyprint">details</code>.</td>
</tr>
<tr>
<td><code class="prettyprint">reset_password</code></td>
<td style="text-align: left">Требуется смена пароля. Измените пароль вызовами POST /wallet/send_password_reset_code и POST /wallet/reset_password.</td>
</tr>
</tbody></table>

<p>Дополнительно реализован <a href="#oauth">протокол OAuth 2.0</a>.</p>
<h2 id='oshibki'>Ошибки</h2>
<p>API использует HTTP статусы для возврата ошибок.</p>

<table><thead>
<tr>
<th style="text-align: right">Статус</th>
<th style="text-align: left">Описание</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: right">200</td>
<td style="text-align: left">запрос выполнен успешно</td>
</tr>
<tr>
<td style="text-align: right">400</td>
<td style="text-align: left">плохо сформированный запрос (например невалидный JSON)</td>
</tr>
<tr>
<td style="text-align: right">401</td>
<td style="text-align: left">неверные учетные данные</td>
</tr>
<tr>
<td style="text-align: right">404</td>
<td style="text-align: left">запрошенный ресурс не существует (для запрашивающего)</td>
</tr>
<tr>
<td style="text-align: right">405</td>
<td style="text-align: left">не тот HTTP метод, например GET вместо POST</td>
</tr>
<tr>
<td style="text-align: right">415</td>
<td style="text-align: left">не тот content-type, мы поддерживаем только application/json</td>
</tr>
<tr>
<td style="text-align: right">422</td>
<td style="text-align: left">запрос сформирован нормально, но не прошел валидацию, например поле не в нужном формате</td>
</tr>
<tr>
<td style="text-align: right">5XX</td>
<td style="text-align: left">проблема с mserver, повторите запрос позже</td>
</tr>
</tbody></table>

<p>HTTP статус дублируется в поле <code class="prettyprint">meta.status</code> ответа mserver. В определенных случаях вместе со статусом возвращается уточненный код ошибки в поле <code class="prettyprint">meta.error</code>. </p>

<blockquote>
<p>Например для неверного формата номера телефона при создании кошелка возвращается</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">422</span><span class="p">,</span><span class="w">
    </span><span class="s2">"error"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"invalid_phone"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='kody-oshibok'>Коды ошибок</h2>
<table><thead>
<tr>
<th style="text-align: left">Код ошибки</th>
<th style="text-align: left">Описание</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">wallet_not_found</td>
<td style="text-align: left">кошелек не существует</td>
</tr>
<tr>
<td style="text-align: left">wallet_not_active</td>
<td style="text-align: left">кошелек не активирован</td>
</tr>
<tr>
<td style="text-align: left">missing_phone</td>
<td style="text-align: left">не передан обязательный параметр: номер телефона</td>
</tr>
<tr>
<td style="text-align: left">missing_password</td>
<td style="text-align: left">не передан обязательный параметр: пароль</td>
</tr>
<tr>
<td style="text-align: left">invalid_password</td>
<td style="text-align: left">пароль должен быть не короче 6 символов</td>
</tr>
<tr>
<td style="text-align: left">invalid_phone</td>
<td style="text-align: left">требуется номер телефона в международном формате</td>
</tr>
<tr>
<td style="text-align: left">phone_already_exists</td>
<td style="text-align: left">пользователь с таким номером телефона уже зарегистрирован</td>
</tr>
<tr>
<td style="text-align: left">already_disabled</td>
<td style="text-align: left">пользователь уже заблокирован</td>
</tr>
<tr>
<td style="text-align: left">already_enabled</td>
<td style="text-align: left">пользователь уже разблокирован</td>
</tr>
<tr>
<td style="text-align: left">already_active</td>
<td style="text-align: left">пользователь уже активирован</td>
</tr>
<tr>
<td style="text-align: left">code_expired</td>
<td style="text-align: left">код безопасности устарел</td>
</tr>
<tr>
<td style="text-align: left">invalid_code</td>
<td style="text-align: left">код безопасности не совпадает с отправленным в смс</td>
</tr>
<tr>
<td style="text-align: left">failure_limit_exceeded</td>
<td style="text-align: left">превышен лимит попыток ввода кода безопасности</td>
</tr>
<tr>
<td style="text-align: left">resend_limit_exceeded</td>
<td style="text-align: left">превышен лимит запросов кода безопасности</td>
</tr>
<tr>
<td style="text-align: left">person_already_verified</td>
<td style="text-align: left">персональные данные уже идентифицированы</td>
</tr>
<tr>
<td style="text-align: left">missing_type</td>
<td style="text-align: left">не передан обязательный параметр: тип платежа</td>
</tr>
<tr>
<td style="text-align: left">missing_amount</td>
<td style="text-align: left">не передан обязательный параметр: сумма платежа</td>
</tr>
<tr>
<td style="text-align: left">missing_parameters</td>
<td style="text-align: left">не передан обязательный параметр: параметры платежа</td>
</tr>
<tr>
<td style="text-align: left">missing_destination</td>
<td style="text-align: left">не передан обязательный параметр: кошелек назначения перевода</td>
</tr>
<tr>
<td style="text-align: left">missing_service</td>
<td style="text-align: left">не передан обязательный параметр: сервис назначения платежа</td>
</tr>
<tr>
<td style="text-align: left">message_too_long</td>
<td style="text-align: left">сообщение адресату перевода не должно быть длиннее 1024 символа</td>
</tr>
<tr>
<td style="text-align: left">invalid_payment_parameters</td>
<td style="text-align: left">обязательный параметр платежа не передан или имеет недопустимое значение</td>
</tr>
<tr>
<td style="text-align: left">invalid_next_action</td>
<td style="text-align: left">неверное действие для многошагового платежа (например pay вместо update)</td>
</tr>
<tr>
<td style="text-align: left">invalid_payment_status</td>
<td style="text-align: left">недопустимый статус платежа для действия pay</td>
</tr>
<tr>
<td style="text-align: left">invalid_amount</td>
<td style="text-align: left">недопустимая сумма платежа</td>
</tr>
<tr>
<td style="text-align: left">card_not_found</td>
<td style="text-align: left">карта не существует</td>
</tr>
<tr>
<td style="text-align: left">service_not_found</td>
<td style="text-align: left">сервис не существует</td>
</tr>
<tr>
<td style="text-align: left">destination_not_found</td>
<td style="text-align: left">адресат перевода не существует</td>
</tr>
<tr>
<td style="text-align: left">invalid_destination</td>
<td style="text-align: left">нельзя отправить перевод самому себе</td>
</tr>
<tr>
<td style="text-align: left">card_not_active</td>
<td style="text-align: left">нельзя платить неактивной картой</td>
</tr>
<tr>
<td style="text-align: left">wallet_not_identified</td>
<td style="text-align: left">для совершения этого действия требуется идентификация пользователя кошелька</td>
</tr>
<tr>
<td style="text-align: left">destination_wallet_not_identified</td>
<td style="text-align: left">получатель p2p перевода не идентифицирован</td>
</tr>
<tr>
<td style="text-align: left">in_amount_limit_exceeded</td>
<td style="text-align: left">превышен лимит на сумму пополнения</td>
</tr>
<tr>
<td style="text-align: left">out_amount_limit_exceeded</td>
<td style="text-align: left">превышен лимит на сумму платежа</td>
</tr>
<tr>
<td style="text-align: left">amount_limit_exceeded</td>
<td style="text-align: left">превышен лимит на остаток на счете кошелька</td>
</tr>
<tr>
<td style="text-align: left">monthly_in_turnover_limit_exceeded</td>
<td style="text-align: left">превышен лимит на месячный оборот пополнений</td>
</tr>
<tr>
<td style="text-align: left">monthly_out_turnover_limit_exceeded</td>
<td style="text-align: left">превышен лимит на месячный оборот платежей</td>
</tr>
<tr>
<td style="text-align: left">active_cards_limit_exceeded</td>
<td style="text-align: left">превышен лимит на количество одновременно привязанных карт</td>
</tr>
<tr>
<td style="text-align: left">insufficient_scope</td>
<td style="text-align: left">недостаточно разрешений (scope) OAuth для выполнения запроса</td>
</tr>
</tbody></table>
<h2 id='kody-bezopasnosti-i-kontrolnyy-razryad'>Коды безопасности и контрольный разряд</h2>
<p>Для активации созданного кошелька и для смены пароля используется 6-значный цифровой код безопасности, который генерируется случайным образом и отправляется СМС сообщением на телефон кошелька.
Запросы на создание кошелька, на повторную отправку кода активации и на отправку кода для смены пароля возвращают в поле <code class="prettyprint">check_digit</code> контрольный разряд для сгенерированного кода безопасности, рассчитанный по <a href="http://en.wikipedia.org/wiki/Verhoeff_algorithm">алгоритму Верхуффа</a>. Клиентские приложения могут использовать контрольный разряд для обнаружения опечаток при вводе кода безопасности.</p>
<h2 id='postranichnyy-vyvod-spiskov'>Постраничный вывод списков</h2>
<p>В ответах на запросы, возвращающие список элементов, сервер отдает полное количество элементов в поле <code class="prettyprint">meta.page.total_elements</code>.</p>
<h2 id='srochnye-dannye'>Срочные данные</h2>
<p>Часто изменяющиеся данные, в самых последних значениях которых заинтересован клиент, возвращаются в каждом ответе сервера в поле <code class="prettyprint">meta.urgent_data</code>. Например, для API кошельков, возвращается доступный остаток на счете кошелька:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">    
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10010</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

          <h1 id='oauth'>OAuth</h1>
<p>mserver поддерживает <a href="http://oauth.net/2/">протокол OAuth 2.0</a>.
Зарегистрированное клиентское приложение может получить <a href="#token-dostupa">токен доступа</a> (access token) по одному из поддерживаемых сценариев (flow):</p>

<ul>
<li>Веб приложения с бэкэндом должны использовать сценарий с кодом авторизации (<a href="http://tools.ietf.org/html/rfc6749#section-1.3.1">authorization code flow</a>).</li>
<li>Мобильный клиент, который сейчас использует BASIC аутентификацию паролем может использовать сценарий с паролем пользователя 
(<a href="http://tools.ietf.org/html/rfc6749#section-1.3.3">password flow</a>).</li>
</ul>
<h2 id='token-dostupa'>Токен доступа</h2>
<p>После успешной OAuth авторизации клиентское приложение получает токен доступа вида 
<code class="prettyprint">b48a991e-e010-4329-9817-f8389a774c45</code>, который может использовать для обращения к API от имени пользователя кошелька. </p>

<p>Время жизни токена зависит от настроек <a href="#testovye-prilozheniya">регистрации</a> приложения в mserver. 
С токеном связан набор <a href="#razresheniya">разрешений</a>, предоставленных пользователем приложению. 
При попытке выполнить неразрешенное действие клиентское приложение получит статус HTTP 403, <code class="prettyprint">insufficient_scope</code> в поле <code class="prettyprint">meta.error</code> ответа и идентификатор разрешения, которого не хватило, в поле <code class="prettyprint">meta.details</code>.</p>

<blockquote>
<p>Успешная аутентификация токеном доступа</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -H <span class="s2">"Authorization: Bearer b48a991e-e010-4329-9817-f8389a774c45"</span> https://www.synq.ru/mserver2-dev/v1/wallet
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">10098.98</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">10098.98</span><span class="p">,</span><span class="w">
    </span><span class="s2">"lock_message"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"t"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Васян Петров"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"verified"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"person_status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"data_verified"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>Попытка выполнить неразрешенное пользователем действие</p>
</blockquote>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: Bearer b48a991e-e010-4329-9817-f8389a774c45"</span> https://www.synq.ru/mserver2-dev/v1/wallet/person
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">403</span><span class="p">,</span><span class="w">
    </span><span class="s2">"error"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"insufficient_scope"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"details"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"person.read"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='stsenariy-s-kodom-avtorizatsii'>Сценарий с кодом авторизации</h2>
<ol>
<li><p>Клиентское приложение перенаправляет клиента на URL авторизации вида <code class="prettyprint">https://www.synq.ru/mserver2-dev/oauth/authorize?response_type=code&amp;client_id=mbank_web&amp;scope=wallet.read payments.read&amp;redirect_uri=https://bestmt.ru/test?ok=1</code></p></li>
<li><p>Происходит перенаправление на страницу логина https://www.synq.ru/mserver2-dev/login</p></li>
<li><p>Пользователь кошелька вводит логин и пароль и нажимает &ldquo;Войти&rdquo;</p></li>
<li><p>Пользователь кошелька выбирает, какие из запрошенных разрешений он согласен предоставить приложению и нажимает &ldquo;Продолжить&rdquo;</p></li>
<li><p>Происходит перенаправление на страницу с кодом авторизации https://bestmt.ru/test?ok=1&amp;code=QnHgkv</p></li>
<li><p>Бэкэнд клиентского приложения обменивает код авторизации на <a href="#token-dostupa">токен доступа</a> POST запросом к сервису токенов mserver <code class="prettyprint">/oauth/token</code>.</p></li>
</ol>
<h3 id='parametry-url-avtorizatsii'>Параметры URL авторизации</h3>
<ul>
<li><code class="prettyprint">response_type</code> - обязательно, фиксированное значение, равное <code class="prettyprint">code</code></li>
<li><code class="prettyprint">client_id</code> - обязательно, <a href="#testovye-prilozheniya">зарегистрированный</a> в mserver ID приложения, которое запрашивает доступ</li>
<li><code class="prettyprint">scope</code> - опционально, перечень запрашиваемых <a href="#razresheniya">разрешений</a>, разделенный пробелами, если ничего не передано, то будут запрошены все разрешения</li>
<li><code class="prettyprint">redirect_uri</code> - опционально, URI на который пользователь будет перенаправлен в случае успешной авторизации, должен быть <a href="#testovye-prilozheniya">зарегистрирован</a> в mserver</li>
</ul>
<h3 id='parametry-zaprosa-k-servisu-tokenov-dlya-authorization-code-flow'>Параметры запроса к сервису токенов для authorization code flow</h3>
<ul>
<li><code class="prettyprint">grant_type</code> - обязательно, фиксированное значение <code class="prettyprint">authorization_code</code></li>
<li>&lsquo;code&rsquo; - обязательно, код авторизации, полученный из URL перенаправления</li>
<li><code class="prettyprint">redirect_uri</code> - опционально, если был задан параметр redirect_uri в URL авторизации</li>
<li><code class="prettyprint">client_id</code> - обязательно, <a href="#testovye-prilozheniya">зарегистрированный</a> в mserver ID приложения, которое запрашивает доступ</li>
</ul>

<blockquote>
<p>Обмен кода авторизации на токен доступа </p>
</blockquote>
<pre class="highlight shell"><code>curl -H <span class="s2">"Accept: application/json"</span> -u mbank_web:topsecret https://www.synq.ru/mserver2-dev/oauth/token -d <span class="s2">"grant_type=authorization_code&amp;code=xT53tR&amp;redirect_uri=https://bestmt.ru/test?ok=1&amp;client_id=mbank_web"</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">10098.98</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"access_token"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"b48a991e-e010-4329-9817-f8389a774c45"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"token_type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"bearer"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"expires_in"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">2147483253</span><span class="p">,</span><span class="w">
    </span><span class="s2">"scope"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"payments.read wallet.read"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='stsenariy-s-peredachey-parolya'>Сценарий с передачей пароля</h2>
<p>Для замены старой схемы аутентификации в мобильном приложении кошелька может быть использован сценарий password flow, при котором бэкэнд приложения обращается к mserver,
чтобы обменять учетные данные приложения и пользователя кошелька (client_id, client_secret, username, password) на <a href="#token-dostupa">токен доступа</a>.</p>
<h3 id='parametry-zaprosa-k-servisu-tokenov-dlya-password-flow'>Параметры запроса к сервису токенов для password flow</h3>
<ul>
<li><code class="prettyprint">grant_type</code> - обязательно, фиксированное значение <code class="prettyprint">password</code></li>
<li><code class="prettyprint">scope</code> - опционально, перечень запрашиваемых <a href="#razresheniya">разрешений</a>, разделенный пробелами, если ничего не передано, то будут запрошены все разрешения</li>
<li><code class="prettyprint">username</code> - обязательно, имя пользователя кошелька (номер телефона в международном формате)</li>
<li><code class="prettyprint">password</code> - обязательно, пароль пользователя кошелька</li>
</ul>

<p>Учетные данные (<code class="prettyprint">client_id</code> и <code class="prettyprint">client_secret</code>) <a href="#testovye-prilozheniya">зарегистрированного</a> клиентского приложения, от имени которого запрашивается токен доступа, передаются BASIC аутентификацией.</p>

<blockquote>
<p>Обмен пароля пользователя кошелька на токен доступа</p>
</blockquote>
<pre class="highlight shell"><code>curl -H <span class="s2">"Accept: application/json"</span> -u mbank:secret https://www.synq.ru/mserver2-dev/oauth/token -d <span class="s2">"grant_type=password&amp;scope=cards.read&amp;username=%2B79201111111&amp;password=password"</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"access_token"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"6a1c96df-662c-4d1d-b046-a7a4ad14b159"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"token_type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"bearer"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"expires_in"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">3599</span><span class="p">,</span><span class="w">
    </span><span class="s2">"scope"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"cards.read"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='razresheniya'>Разрешения</h2>
<table><thead>
<tr>
<th style="text-align: left">Разрешение</th>
<th style="text-align: left">Описание</th>
<th style="text-align: left">Разрешенные запросы API</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">wallet.read</td>
<td style="text-align: left">Просмотр кошелька</td>
<td style="text-align: left">GET /v1/wallet</td>
</tr>
<tr>
<td style="text-align: left">person.read</td>
<td style="text-align: left">Просмотр персональных данных</td>
<td style="text-align: left">GET /v1/wallet/person</td>
</tr>
<tr>
<td style="text-align: left">person.modify</td>
<td style="text-align: left">Задание персональных данных</td>
<td style="text-align: left">POST /v1/wallet/person</td>
</tr>
<tr>
<td style="text-align: left">cards.read</td>
<td style="text-align: left">Просмотр сохраненных карт</td>
<td style="text-align: left">GET /v1/cards</td>
</tr>
<tr>
<td style="text-align: left">cards.modify</td>
<td style="text-align: left">Сохранение/удаление карты</td>
<td style="text-align: left">POST DELETE /v1/cards</td>
</tr>
<tr>
<td style="text-align: left">payments.read</td>
<td style="text-align: left">Просмотр истории платежей</td>
<td style="text-align: left">GET /v1/payments</td>
</tr>
<tr>
<td style="text-align: left">payments.modify</td>
<td style="text-align: left">Совершение платежа</td>
<td style="text-align: left">POST /v1/payments</td>
</tr>
</tbody></table>
<h2 id='testovye-prilozheniya'>Тестовые приложения</h2>
<table><thead>
<tr>
<th style="text-align: left">client_id</th>
<th style="text-align: left">client_secret</th>
<th style="text-align: left">Разрешенные сценарии</th>
<th style="text-align: left">URL перенаправления</th>
<th style="text-align: left">Время жизни токена, секунды</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">mbank</td>
<td style="text-align: left">secret</td>
<td style="text-align: left">password</td>
<td style="text-align: left"></td>
<td style="text-align: left">3600</td>
</tr>
<tr>
<td style="text-align: left">mbank_web</td>
<td style="text-align: left">topsecret</td>
<td style="text-align: left">authorization_code</td>
<td style="text-align: left">http://refill.dev http://refill.nebo15.me http://mbank.dev http://schet.dev http://schet.nebo15.me http://schet.ru</td>
<td style="text-align: left">2147483647</td>
</tr>
<tr>
<td style="text-align: left">mbank_storefront</td>
<td style="text-align: left">oklol</td>
<td style="text-align: left">client_credentials</td>
<td style="text-align: left">http://refill.dev http://refill.nebo15.me http://mbank.dev http://schet.dev http://schet.nebo15.me http://schet.ru</td>
<td style="text-align: left">2147483647</td>
</tr>
<tr>
<td style="text-align: left">mbank_bov</td>
<td style="text-align: left">secret</td>
<td style="text-align: left">password</td>
<td style="text-align: left"></td>
<td style="text-align: left">3600</td>
</tr>
</tbody></table>

          <h1 id='koshelek'>Кошелек</h1>
<p>Кошелек - учетная запись конечного пользователя в mserver. Позволяет получать информацию о доступном остатке на счете и персональных данных конечного пользователя.  </p>

<blockquote>
<p>Пример </p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10010</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">    
    </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="p">,</span><span class="w">    
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="s2">"level"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"anonymous"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Алексей Арсеньев"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"verified"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="s2">"person_status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"data_entered"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h3 id='polya'>Поля</h3>
<ul>
<li><code class="prettyprint">phone</code> - номер телефона в международном формате, уникальный идентификатор Кошелька (в пределах Проекта), также является логином</li>
<li><code class="prettyprint">amount</code> - остаток на счете кошелька, в рублях</li>
<li><code class="prettyprint">name</code> - имя конечного пользователя, возвращается в случае, если были заданы имя и/или фамилия</li>
<li><code class="prettyprint">verified</code> - <code class="prettyprint">true</code>|<code class="prettyprint">false</code> статус идентификации пользователя</li>
<li><code class="prettyprint">level</code> - <code class="prettyprint">anonymous</code> | <code class="prettyprint">identified</code> | <code class="prettyprint">personified</code> уровень идентификации пользователя</li>
<li><code class="prettyprint">person_status</code> - <code class="prettyprint">no_data</code> | <code class="prettyprint">data_entered</code> | <code class="prettyprint">data_verified</code> статус персональных данных пользователя</li>
</ul>
<h2 id='sozdanie-koshelka'>Создание кошелька</h2>
<aside class="notice">При создании кошелька на dev сервере на счет зачисляется 10000 рублей.</aside>
<h3 id='parametry'>Параметры</h3>
<ul>
<li><code class="prettyprint">phone</code> - номер телефона в международном формате</li>
<li><code class="prettyprint">password</code> - пароль, не короче 6 символов</li>
</ul>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -H <span class="s1">'Content-type:application/json'</span>
 -d <span class="s1">'{"phone": "+79261111111", "password": "password"}'</span>
 https://www.synq.ru/mserver2-dev/v1/wallet
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"check_digit"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"8"</span><span class="w"> 
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"dev"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"security_code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"242321"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h3 id='kody-oshibok'>Коды ошибок</h3>
<ul>
<li><code class="prettyprint">missing_phone</code> - не передан номер телефона</li>
<li><code class="prettyprint">invalid_phone</code> - номер телефона не соответствует международному формату</li>
<li><code class="prettyprint">missing_password</code> - не передан пароль</li>
<li><code class="prettyprint">invalid_password</code> - пароль короче 6 символов</li>
<li><code class="prettyprint">phone_already_exists</code> - кошелек с таким номером телефона уже существует (и активирован)</li>
<li><code class="prettyprint">wallet_not_active</code> - кошелек с таким номером телефона уже существует и его нужно активировать кодом из СМС</li>
</ul>

<p>После создания кошелька требуется активация (подтверждение номера телефона) кодом, который отправлен в СМС сообщении. До выполнения активации
аутентифицироваться на mserver учетными данными кошелька будет нельзя. Сервер будет возвращать HTTP статус 401 с кодом ошибки <code class="prettyprint">wallet_not_active</code>.</p>

<blockquote>
<p>Ошибка до активации кошелька</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">401</span><span class="p">,</span><span class="w">
    </span><span class="s2">"error"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"wallet_not_active"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<aside class="notice">На dev сервере код не отправляется в СМС и возвращается в ответе в поле `dev.security_code`</aside>
<h2 id='aktivatsiya-koshelka'>Активация кошелька</h2><h3 id='parametry'>Параметры</h3>
<ul>
<li><code class="prettyprint">phone</code> - номер телефона в международном формате</li>
<li><code class="prettyprint">code</code> - код активации кошелька из СМС сообщения</li>
</ul>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -H <span class="s1">'Content-type:application/json'</span>  
 -d <span class="s1">'{"phone": "+79261111111", "code": "242321"}'</span> 
 https://www.synq.ru/mserver2-dev/v1/wallet/activate
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h3 id='kody-oshibok'>Коды ошибок</h3>
<ul>
<li><code class="prettyprint">missing_phone</code> - не передан номер телефона</li>
<li><code class="prettyprint">invalid_phone</code> - номер телефона не соответствует международному формату</li>
<li><code class="prettyprint">missing_code</code> - не передан код активации</li>
<li><code class="prettyprint">already_active</code> - кошелек с телефоном <code class="prettyprint">phone</code> уже активирован</li>
<li><code class="prettyprint">invalid_code</code> - переданный код активации не совпадает с присланным в СМС</li>
<li><code class="prettyprint">code_expired</code> - с момента создания кода активации прошло больше 15 минут, запросите код повторно</li>
<li><code class="prettyprint">failure_limit_exceeded</code> - вы прислали неверный код активации больше 5 раз, обратитесь в поддержку</li>
</ul>
<h2 id='zapros-povtornoy-otpravki-koda-aktivatsii'>Запрос повторной отправки кода активации</h2>
<aside class="notice">На dev сервере код не отправляется в СМС и возвращается в ответе в поле `dev.security_code`</aside>
<h3 id='parametry'>Параметры</h3>
<ul>
<li><code class="prettyprint">phone</code> - номер телефона в международном формате</li>
</ul>
<pre class="highlight shell"><code>curl -H <span class="s1">'Content-type:application/json'</span>
 -d <span class="s1">'{"phone": "+79261111111"}'</span> 
 https://www.synq.ru/mserver2-dev/v1/wallet/resend_code
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"check_digit"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"3"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"dev"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"security_code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"482721"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h3 id='kody-oshibok'>Коды ошибок</h3>
<ul>
<li><code class="prettyprint">missing_phone</code> - не передан номер телефона</li>
<li><code class="prettyprint">invalid_phone</code> - номер телефона не соответствует международному формату</li>
<li><code class="prettyprint">already_active</code> - кошелек с телефоном <code class="prettyprint">phone</code> уже активирован</li>
<li><code class="prettyprint">failure_limit_exceeded</code> - вы прислали неверный код активации больше 5 раз, обратитесь в поддержку</li>
<li><code class="prettyprint">resend_limit_exceeded</code> - mserver отправил отведенные 5 СМС сообщений с кодами активации, обратитесь в поддержку</li>
</ul>
<h2 id='zapros-koda-dlya-smeny-parolya'>Запрос кода для смены пароля</h2>
<aside class="notice">На dev сервере код не отправляется в СМС и возвращается в ответе в поле `dev.security_code`</aside>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -H <span class="s1">'Content-type:application/json'</span> 
 -d <span class="s1">'{"phone": "+79261111111"}'</span>
 https://www.synq.ru/mserver2-dev/v1/wallet/send_password_reset_code
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"check_digit"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"dev"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"security_code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"934879"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h3 id='kody-oshibok'>Коды ошибок</h3>
<ul>
<li><code class="prettyprint">failure_limit_exceeded</code> - вы прислали неверный код смены пароля больше 5 раз, обратитесь в поддержку</li>
<li><code class="prettyprint">resend_limit_exceeded</code> - mserver отправил отведенные 5 СМС сообщений с кодами смены пароля, обратитесь в поддержку</li>
<li><code class="prettyprint">wallet_not_active</code> - кошелек не активирован</li>
<li><code class="prettyprint">wallet_disabled</code> - кошелек заблокирован</li>
</ul>
<h2 id='smena-parolya'>Смена пароля</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -H <span class="s1">'Content-type:application/json'</span> 
 -d <span class="s1">'{"code": "934879", "password": "PassWord", "phone": "+79261111111"}'</span> ttps://www.synq.ru/mserver2-dev/v1/wallet/reset_password
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h3 id='kody-oshibok'>Коды ошибок</h3>
<ul>
<li><code class="prettyprint">missing_code</code> - не передан код смены пароля </li>
<li><code class="prettyprint">invalid_code</code> - переданный код смены пароля не совпадает с присланным в СМС</li>
<li><code class="prettyprint">code_expired</code> - с момента создания кода смены пароля прошло больше 15 минут, запросите код повторно</li>
<li><code class="prettyprint">failure_limit_exceeded</code> - вы прислали неверный код смены пароля больше 5 раз, обратитесь в поддержку</li>
<li><code class="prettyprint">wallet_not_active</code> - кошелек не активирован</li>
<li><code class="prettyprint">wallet_disabled</code> - кошелек заблокирован</li>
</ul>
<h2 id='zagruzka-koshelka'>Загрузка кошелька</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password https://www.synq.ru/mserver2-dev/v1/wallet
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10010</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">    
    </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Алексей Арсеньев"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"verified"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">    
    </span><span class="s2">"level"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"anonymous"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"person_status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"data_entered"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='poisk-koshelkov'>Поиск кошельков</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span> 
-d <span class="s1">'{"phones": ["+79990000000", "+79260000001", "+79260000002"]}'</span> 
https://www.synq.ru/mserver2-dev/v1/wallet/find
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10010</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79260000001"</span><span class="w">
  </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79260000002"</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='zadanie-personalnyh-dannyh-polzovatelya'>Задание персональных данных пользователя</h2><h3 id='parametry'>Параметры</h3>
<ul>
<li><code class="prettyprint">family_name</code> - фамилия</li>
<li><code class="prettyprint">given_name</code> - имя</li>
<li><code class="prettyprint">patronymic_name</code> - отчество</li>
<li><code class="prettyprint">birth_date</code> - дата рождения в формате гггг-мм-дд </li>
<li><code class="prettyprint">passport_series_number</code> - серия и номер паспорта, 10 цифр</li>
<li><code class="prettyprint">passport_issued_at</code> - дата в формате гггг-мм-дд</li>
<li><code class="prettyprint">itn</code> - ИНН, 12 цифр</li>
<li><code class="prettyprint">ssn</code> - СНИЛС, 11 цифр</li>
</ul>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span> 
-d <span class="s1">'{"family_name": "Арсеньев", "given_name": "Алексей", "patronymic_name": "Александрович", 
"birth_date": "1982-01-02", "passport_series_number": "2202655885", "passport_issued_at" : "2012-02-27", 
"itn": "330500938709", "ssn": "11223344595"}'</span>  
https://www.synq.ru/mserver2-dev/v1/wallet/person
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10010</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"family_name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Арсеньев"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"given_name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Алексей"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"patronymic_name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Александрович"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"birth_date"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1982-01-02"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"passport_series_number"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2202655885"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"passport_issued_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-02-27"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"itn"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"330500938709"</span><span class="p">,</span><span class="w">                       
    </span><span class="s2">"ssn"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"11223344595"</span><span class="p">,</span><span class="w">                        
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"data_entered"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h3 id='kody-oshibok'>Коды ошибок</h3>
<ul>
<li><code class="prettyprint">invalid_family_name</code> - фамилия длиннее 512 символов</li>
<li><code class="prettyprint">invalid_given_name</code> - имя длиннее 512 символов</li>
<li><code class="prettyprint">invalid_patronymic_name</code> - отчество длиннее 512 символов</li>
<li><code class="prettyprint">invalid_passport_series_number</code> - серия/номер паспорта не соответствует формату</li>
<li><code class="prettyprint">invalid_itn</code> - ИНН не соответствует формату</li>
<li><code class="prettyprint">invalid_ssn</code> - СНИЛС не соответствует формату</li>
<li><code class="prettyprint">person_already_verified</code> - перcональные данные утверждены, изменение невозможно, обратитесь в поддержку</li>
</ul>
<h2 id='zagruzka-personalnyh-dannyh-polzovatelya'>Загрузка персональных данных пользователя</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password https://www.synq.ru/mserver2-dev/v1/wallet/person
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10010</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"family_name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Арсеньев"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"given_name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Алексей"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"patronymic_name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Александрович"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"birth_date"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1982-01-02"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"passport_series_number"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2202655885"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"passport_issued_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-02-27"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"itn"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"330500938709"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ssn"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"11223344595"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"data_verified"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"verified_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-05-29T17:06:20.066Z"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='statusy-personalnyh-dannyh'>Статусы персональных данных</h2>
<table><thead>
<tr>
<th style="text-align: left">Код статуса ПД</th>
<th style="text-align: left">Описание</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code class="prettyprint">data_entered</code></td>
<td style="text-align: left">Персональные данные введены пользователем, изменение ПД возможно</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">data_verified</code></td>
<td style="text-align: left">Персональные данные проверены, дальнейшее изменение ПД невозможно</td>
</tr>
</tbody></table>
<h2 id='zapros-personalnyh-dannyh-klienta-sistemy-best'>Запрос персональных данных клиента системы БЭСТ</h2>
<p>Возвращает список наборов персональных данных клиента системы денежных переводов БЭСТ полученный поиском по номеру телефона кошелька, либо по номеру карты клиента БЭСТ.
Одному номеру телефона в системе БЭСТ может соответствовать более одного набора персональных данных.</p>
<h3 id='parametry'>Параметры</h3>
<ul>
<li><code class="prettyprint">card_number</code> - номер карты клиента БЭСТ</li>
<li><code class="prettyprint">pin</code> - PIN код</li>
</ul>
<h3 id='zapros-po-nomeru-telefona-koshelka'>Запрос по номеру телефона кошелька</h3><pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password https://www.synq.ru/mserver2-dev/v1/wallet/client
</code></pre>
<h3 id='zapros-po-nomeru-karty-klienta-best'>Запрос по номеру карты клиента БЭСТ</h3><pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password https://www.synq.ru/mserver2-dev/v1/wallet/client?card_number<span class="o">=</span>8003330316000271&amp;pin<span class="o">=</span>1234
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">18.51</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"page"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"total_elements"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"lastname"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Арсеньев"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"firstname"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Алексей"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"patronymic"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Александрович"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"account"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
      </span><span class="s2">"isresident"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="s2">"id_card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"8003330316000271"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"id_client"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">147</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"address"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"street"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
      </span><span class="s2">"house"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
      </span><span class="s2">"house_block"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
      </span><span class="s2">"house_building"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
      </span><span class="s2">"flat"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
      </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"79261111111"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"email"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"data_extended"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"inn"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
      </span><span class="s2">"birth_day"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1982-01-01T21:00:00.000+0000"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"birth_place"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Город Орёл Орловской области"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"migration_card_number"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"identification"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Паспорт гражданина Российской Федерации_"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"series"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2202"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"number"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"655885"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"issuer"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Отделом УФМС России по гор Орёл"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"issue_date"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2013-02-06T20:00:00.000+0000"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"dep_code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

          <h1 id='servisy'>Сервисы</h1>
<p>Сервис - это назначение платежа. Сервис содержит описание параметров, которые должны быть переданы в платежном запросе конечным пользователем.</p>

<blockquote>
<p>Пример</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w">
    </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Альфа Банк"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"min"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
    </span><span class="s2">"max"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">15000</span><span class="p">,</span><span class="w">
    </span><span class="s2">"verification_required"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"min_length"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w">
      </span><span class="s2">"max_length"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ карты (16 цифр)"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"pattern"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"^\\d{16}$"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"pattern_description"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ карты (16 цифр)"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"items"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h3 id='polya'>Поля</h3>
<ul>
<li><code class="prettyprint">id</code> - идентификатор сервиса, передается в платежном запросе в поле <code class="prettyprint">service</code> для указания назначения платежа</li>
<li><code class="prettyprint">name</code> - человекочитаемое имя сервиса</li>
<li><code class="prettyprint">min</code>, <code class="prettyprint">max</code> - минимальная и максимальная сумма платежа, включительно</li>
<li><code class="prettyprint">verification_required</code> - true | false требуется ли идентификация плательщика</li>
<li><code class="prettyprint">parameters.code</code> - ключ параметра платежа</li>
<li><code class="prettyprint">min_length</code>, <code class="prettyprint">max_length</code> - минимальная и максимальная длина значения параметра платежа</li>
<li><code class="prettyprint">name</code> - человекочитаемое имя параметра</li>
<li><code class="prettyprint">pattern</code> - регулярное выражение, которому должно удовлетворять значение параметра платежа</li>
<li><code class="prettyprint">pattern_description</code> - человекочитаемое описание для <code class="prettyprint">pattern</code></li>
<li><code class="prettyprint">type</code> - numeric|text|enum тип параметра платежа, число/текст/перечисление</li>
<li><code class="prettyprint">items</code> - возможные значения параметра платежа с типом enum</li>
</ul>
<h2 id='zagruzka-spiska-servisov'>Загрузка списка сервисов</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password https://www.synq.ru/mserver2-dev/v1/services?size<span class="o">=</span>1
</code></pre>
<pre class="highlight json"><code><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="s2">"total_elements"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">23</span><span class="p">,</span><span class="w">
     </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10010</span><span class="w">
    </span><span class="p">}</span><span class="w">

   </span><span class="p">},</span><span class="w">
   </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w">
     </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Альфа Банк"</span><span class="p">,</span><span class="w">
     </span><span class="s2">"min"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
     </span><span class="s2">"max"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">15000</span><span class="p">,</span><span class="w">
     </span><span class="s2">"verification_required"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
     </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
       </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
       </span><span class="s2">"min_length"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w">
       </span><span class="s2">"max_length"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w">
       </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ карты (16 цифр)"</span><span class="p">,</span><span class="w">
       </span><span class="s2">"pattern"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"^\\d{16}$"</span><span class="p">,</span><span class="w">
       </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">,</span><span class="w">
       </span><span class="s2">"pattern_description"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ карты (16 цифр)"</span><span class="p">,</span><span class="w">
       </span><span class="s2">"items"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w">
     </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
       </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"valid"</span><span class="p">,</span><span class="w">
       </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Срок действия (вид: ГГММ)"</span><span class="p">,</span><span class="w">
       </span><span class="s2">"pattern"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"^\\d{4}$"</span><span class="p">,</span><span class="w">
       </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
       </span><span class="s2">"pattern_description"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Срок действия (вид: ГГММ)"</span><span class="p">,</span><span class="w">
       </span><span class="s2">"items"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w">
     </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
   </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='zagruzka-servisa-po-identifikatoru'>Загрузка сервиса по идентификатору</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password https://www.synq.ru/mserver2-dev/v1/services/1
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10010</span><span class="w">
    </span><span class="p">}</span><span class="w">

  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Мегафон"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"min"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"max"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">15000</span><span class="p">,</span><span class="w">
    </span><span class="s2">"verification_required"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"min_length"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
      </span><span class="s2">"max_length"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ телефона (10 цифр)"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"pattern"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"^\\d{10}$"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"pattern_description"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ телефона (10 цифр)"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"items"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='servisy-po-gruppam'>Сервисы по группам</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password https://www.synq.ru/mserver2-dev/v1/services/groups?size<span class="o">=</span>1
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"total_elements"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">23</span><span class="p">,</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10010</span><span class="w">
    </span><span class="p">}</span><span class="w">

  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"bank"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Банковские услуги"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"services"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Альфа Банк"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"min"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
      </span><span class="s2">"max"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">15000</span><span class="p">,</span><span class="w">
      </span><span class="s2">"verification_required"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"min_length"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w">
        </span><span class="s2">"max_length"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ карты (16 цифр)"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"pattern"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"^\\d{16}$"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"pattern_description"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ карты (16 цифр)"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"items"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"valid"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Срок действия (вид: ГГММ)"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"pattern"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"^\\d{4}$"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"pattern_description"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Срок действия (вид: ГГММ)"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"items"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='poisk-podhodyaschego-servisa-po-nomeru-karty-ili-telefona'>Поиск подходящего сервиса по номеру карты или телефона</h2><h3 id='polya'>Поля</h3>
<ul>
<li><code class="prettyprint">type</code> - phone | card тип поиска</li>
<li><code class="prettyprint">input</code> - номер карты или телефона</li>
</ul>

<blockquote>
<p>Пример поиска по номеру карты</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password https://www.synq.ru/mserver2-dev/v1/services/search?type<span class="o">=</span>card&amp;input<span class="o">=</span>5417150970409149
</code></pre>

<blockquote>
<p>Пример поиска по номеру телефона</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password <span class="s2">"https://www.synq.ru/mserver2-dev/v1/services/search?type=phone&amp;input=9099560000"</span> 
</code></pre>

<blockquote>
<p>Пример возвращаемых данных</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
    </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Билайн"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"min"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="s2">"max"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">15000</span><span class="p">,</span><span class="w">
    </span><span class="s2">"verification_required"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"min_length"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
      </span><span class="s2">"max_length"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Номер телефона"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"pattern_description"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"10-ти значный федеральный номер"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"items"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

          <h1 id='platezhi'>Платежи</h1>
<p>Платеж - это операция движения денежных средств между счетами mserver выполняемая по распоряжению пользователя. Платежи различаются по типу:</p>

<table><thead>
<tr>
<th style="text-align: left">Код типа платежа</th>
<th style="text-align: left">Описание</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code class="prettyprint">out</code></td>
<td style="text-align: left">Вывод средств со счета кошелька пользователя в пользу провайдера (провайдер КредитПилот)</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">p2p</code></td>
<td style="text-align: left">Перевод денег со счета кошелька пользователя на счет кошелька другого пользователя</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">in</code></td>
<td style="text-align: left">Ввод средств на счет кошелька пользователя через провайдера (провайдеры КредитПилот, ИПСП, Рапида)</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">inout</code></td>
<td style="text-align: left">Транзит средств от ИПСП в пользу КредитПилот</td>
</tr>
</tbody></table>
<h3 id='polya-obschie-dlya-vseh-tipov-platezhey'>Поля, общие для всех типов платежей</h3>
<ul>
<li><code class="prettyprint">type</code> - in|out|p2p|inout тип Платежа</li>
<li><code class="prettyprint">client_payment_id</code> - клиентский идентификатор (UUID)</li>
<li><code class="prettyprint">amount</code> - сумма к зачислению в рублях</li>
<li><code class="prettyprint">total</code> - полная сумма Платежа с учетом комиссии в рублях</li>
<li><code class="prettyprint">createdAt</code> - время создания</li>
<li><code class="prettyprint">processedAt</code> - время завершения online обработки</li>
<li><code class="prettyprint">status</code> - состояние</li>
<li><code class="prettyprint">decline_reason</code> - причина отказа в проведении</li>
</ul>
<h3 id='polya-dlya-platezhey-tipa-code-classprettyprintoutcode--code-classprettyprintinoutcode-vyvod-deneg--tranzit'>Поля для платежей типа <code class="prettyprint">out</code> / <code class="prettyprint">inout</code> (вывод денег / транзит)</h3>
<ul>
<li><code class="prettyprint">service</code> - назначение платежа</li>
<li><code class="prettyprint">outbound</code> - провайдер, на счет которого были отправлены деньги со счете кошелька</li>
<li><code class="prettyprint">parameters</code> - параметры платежа, например номер карты/телефона</li>
</ul>
<h3 id='polya-dlya-tipa-code-classprettyprintincode--code-classprettyprintinoutcode-vvod-deneg--tranzit'>Поля для типа <code class="prettyprint">in</code> / <code class="prettyprint">inout</code> (ввод денег / транзит)</h3>
<ul>
<li><code class="prettyprint">inbound</code> - провайдер, со счета которого деньги пришли на счет кошелька</li>
<li><code class="prettyprint">card</code> - карта с которой прошло пополнение</li>
</ul>
<h3 id='polya-dlya-tipa-code-classprettyprintp2pcode-perevod-mezhdu-koshelkami'>Поля для типа <code class="prettyprint">p2p</code> (перевод между кошельками)</h3>
<ul>
<li><code class="prettyprint">destination</code> - кошелек назначения перевода</li>
<li><code class="prettyprint">message</code> - сообщение адресату перевода</li>
</ul>
<h2 id='statusy-platezha'>Статусы платежа</h2>
<table><thead>
<tr>
<th style="text-align: left">Код статуса платежа</th>
<th style="text-align: left">Описание</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code class="prettyprint">created</code></td>
<td style="text-align: left">Платеж создан (например вызовом POST /payments) и ожидает от клиента команды на исполнение</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">processing</code></td>
<td style="text-align: left">Платеж был запущен в обработку (например вызовом POST /payments/{id}/pay и исполняется</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">completed</code></td>
<td style="text-align: left">Платеж успешно исполнен</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">declined</code></td>
<td style="text-align: left">Платеж отклонен, с уточнением причины в поле <code class="prettyprint">decline_reason</code></td>
</tr>
</tbody></table>
<h2 id='prichiny-otkaza-v-provedenii-platezha'>Причины отказа в проведении платежа</h2>
<table><thead>
<tr>
<th style="text-align: left">Код причины отказа</th>
<th style="text-align: left">Описание</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code class="prettyprint">invalid_data</code></td>
<td style="text-align: left">Неверные данные платежа (например неверный номер карты/номер телефона)</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">insufficient_funds</code></td>
<td style="text-align: left">Недостаточно средств на счете кошелька</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">internal_error</code></td>
<td style="text-align: left">Что-то пошло не так, обратитесь в поддержку</td>
</tr>
</tbody></table>
<h2 id='klientskiy-identifikator-platezha'>Клиентский идентификатор платежа</h2>
<p>Клиент может генерировать <a href="http://wikipedia.org/wiki/UUID">UUID</a> для каждого отдельного платежа и передавать его в поле <code class="prettyprint">client_payment_id</code> платежного запроса. Если в процессе создания платежа такой клиент получил ошибку I/O, он должен повторять запрос создания платежа с тем же самым <code class="prettyprint">client_payment_id</code> до получения ответа. Гарантируется, что платеж с данным <code class="prettyprint">client_payment_id</code> будет создан не более 1 раза.</p>
<h2 id='provedenie-platezha'>Проведение платежа</h2>
<p>Для передачи mserver платежа на исполнение клиент следует общепринятому в платежной индустрии двухфазному протоколу. В первой фазе, подготовительной, клиент создает в mserver Платеж с необходимыми параметрами. 
По завершении подготовительной фазы клиент получает от mserver информацию о полной стоимости платежа (поле <code class="prettyprint">total</code>) и предъявляет полную стоимость платежа пользователю кошелька. 
В случае согласия пользователя с условиями исполнения платежа клиент от имени пользователя инициирует исполнение подготовленного платежа (вторая фаза, платежная).</p>

<p><img alt="проведение платежа" src="http://www.websequencediagrams.com/cgi-bin/cdraw?lz=dGl0bGUg0JTQstGD0YXRhNCw0LfQvdGL0Lkg0L_Qu9Cw0YLQtdC2AAoJ0YDQvtGC0L7QutC-0LsgbXNlcnZlcgoKbm90ZSBvdmVyIGNsaWVudCwAEwg6INCf0L7QtNCzADIHstC4AE8Fu9GM0LDRjyAAbQewCgoANAYtPgAxCVBPU1QgL3BheW1lbnRzIHtwYXJhbXN9AGcGcmlnaHQgb2YAYAkKAIEGCCDRgdC-0LfQtNCw0LXRggCBPA0sCiDRgNCw0YHRgdGH0LjRgtGL0LIAIAi60L7QvNC40YHRgdC40Y4KINC90LjQutGC0L4AAwiD0LTQsCDQtdGJ0LUg0L3QtQCCHQq40YIKZW5kIG5vdGUKCgCCEwctPgCCCgY6IHtpZDogMTIzLCBhbW91bnQ6IDEwMCwgdG90YWw6IDExMCwgbmV4dF9hY3Rpb246IHBheX0AglEHbGVmAIFlBQBEBwog0LrQu9C40LXQvQCBWQa-0LrQsNC3AIFADL_QvgCCXgW3AIJuBQCDQQa70Y4gCgAUB9C90YPRjiDRgQCDSQW40LzQvtGB0YLRjACDag6wIDExMCDRgAoAOheMAIJnBrMAhCYFgdC10L0AggQN0YwAgggLAIQGHgCEYQsAg2ouLzEyMy9wYXkAg3YhAFQFh9C40L0AhBAJ0YAAhQ0FvtC0AIEoBgCFaA0AgloO0YMAhXkGtdC00LvQsNCzAIRYBtGB0Y8g0L4AhhUFsNGI0LgAgmgG0YwKAIUCBQCCWgbRjwCERQUAhCILAIJXBQCEJQoAhBwSAIN_DWdldH0Ahg0TR0UAgXgPAIRjE3N0YXR1czogY29tcGxldGVkAIY4BwCEMSO70YPRhwCGPQcAgSshIAoAWQogKNC40YEAhGAI0LXQvSkKIFlheSEAhhcJ&amp;s=modern-blue" /></p>
<h2 id='poluchenie-istorii-platezhey'>Получение истории платежей</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password <span class="s2">"https://www.synq.ru/mserver2-dev/v1/payments?page=0&amp;size=35&amp;type=out,in&amp;status=completed,declined"</span>
</code></pre>

<p>Параметры <code class="prettyprint">page</code> и <code class="prettyprint">size</code> в запросе позволяют задать номер (начиная с 0) и размер страницы, которую запрашивает клиент. По умолчанию номер страницы - 0 и размер страницы - 35 платежей.
Опциональные параметры <code class="prettyprint">type</code> и <code class="prettyprint">status</code> позволяют фильтровать платежи по типу и статусу.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"page"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"total_elements"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10010</span><span class="w">
    </span><span class="p">}</span><span class="w">

  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089238188</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"e131a7e2-c553-4295-867e-1023359bee31"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">5.01</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-08T16:08:56.536Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"declined"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"out"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"service"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MTS Украина"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ телефона (9-10 цифр)"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"0509244604"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="s2">"outbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ТПР (провайдер)"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089238187</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"e731a7e2-c553-4295-867e-1023359bee31"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">5.01</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-08T16:05:40.110Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"processed_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-08T16:07:41.435Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"completed"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"out"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"service"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MTS Украина"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ телефона (9-10 цифр)"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"0509244604"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="s2">"outbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ТПР (провайдер)"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089238186</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1331a7e2-c553-4295-867e-1023359bee38"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">4.01</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-08T15:14:42.620Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"declined"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"decline_reason"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"internal_error"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"out"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"service"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MTS Украина"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ телефона (9-10 цифр)"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1509244604"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="s2">"outbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ТПР (провайдер)"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089238185</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1231a7e2-c553-4295-867e-1023359bee38"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">4.01</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-08T15:13:28.298Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"declined"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"decline_reason"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"internal_error"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"out"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"service"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MTS Украина"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ телефона (9-10 цифр)"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"0509244604"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="s2">"outbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ТПР (провайдер)"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089238184</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1731a7e2-c553-4295-867e-1023359bee38"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">4.01</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-08T15:11:19.489Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"declined"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"out"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"service"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MTS Украина"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ телефона (9-10 цифр)"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"0509244604"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="s2">"outbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ТПР (провайдер)"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089238183</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"e731a7e2-c553-4295-867e-1023359bee34"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">4.01</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-08T14:58:52.154Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"declined"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"out"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"service"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MTS Украина"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ телефона (9-10 цифр)"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"0509244604"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="s2">"outbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ТПР (провайдер)"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089238182</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"e731a7e2-c553-4295-867e-1023359bee38"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">4.01</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-08T14:56:39.222Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"declined"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"out"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"service"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MTS Украина"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ телефона (9-10 цифр)"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"0509244604"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="s2">"outbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ТПР (провайдер)"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089238181</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"e731a7e2-c553-4295-867e-1023359bee28"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">4.01</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-08T14:25:44.646Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"processed_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-08T14:26:55.029Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"completed"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"out"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"service"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MTS Украина"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ телефона (9-10 цифр)"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"0509244604"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="s2">"outbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ТПР (провайдер)"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='uvedomleniya-ob-izmenenii-statusa-platezha'>Уведомления об изменении статуса платежа</h2>
<p>Для уведомления внешней системы об изменениях статуса платежа mserver выполняет POST запрос на URL /payments/status. Уведомление передается в теле POST запроса в виде объекта платежной операции сериализованного в JSON. Например:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-08-02T14:37:20.102Z"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"payment"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089240253</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"a02b1416-b9c1-4782-88c5-da4d78b32f8d"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-08-02T14:36:02.997Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"processed_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-08-02T14:37:20.102Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"completed"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"used"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******2399"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"from"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"processing"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"to"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"completed"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"complete"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h3 id='polya'>Поля</h3>
<ul>
<li><code class="prettyprint">created_at</code> - момент времени совершения платежной операции</li>
<li><code class="prettyprint">payment</code> - стандартное представление объекта платежа описанное выше</li>
<li><code class="prettyprint">from</code> - начальный статус платежа</li>
<li><code class="prettyprint">to</code> - конечный статус платежа</li>
<li><code class="prettyprint">type</code> - тип платежной операции, см. ниже</li>
</ul>
<h3 id='tipy-platezhnyh-operatsiy'>Типы платежных операций</h3>
<table><thead>
<tr>
<th style="text-align: left">Тип</th>
<th style="text-align: left">Описание</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code class="prettyprint">complete</code></td>
<td style="text-align: left">Платеж проведен</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">decline</code></td>
<td style="text-align: left">Платеж отклонен</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">undo</code></td>
<td style="text-align: left">Отмена ранее успешного платежа (сторно)</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">redo</code></td>
<td style="text-align: left">Ранее отмененный платеж сделан успешным (сторно сторно and we need to go deeper)</td>
</tr>
</tbody></table>

          <h1 id='platezh-so-scheta-koshelka'>Платеж со счета кошелька</h1><h3 id='parametry'>Параметры</h3>
<ul>
<li><code class="prettyprint">type</code> = out - тип платежа</li>
<li><code class="prettyprint">client_payment_id</code> - клиентский идентификатор платежа (опциональный)</li>
<li><code class="prettyprint">amount</code> -  сумма к зачислению</li>
<li><code class="prettyprint">service</code> - назначение платежа, идентификатор Сервиса</li>
<li><code class="prettyprint">parameters</code> - параметры платежного запроса в соответствии с /services/{service}</li>
</ul>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span> 
 -d <span class="s1">'{"type": "out", "client_payment_id": "e731a7e2-c553-4295-867e-1023359bee28", 
 "amount": 100, "service": 61, "parameters": {"phoneNumber": "9267101283", 
 "BIK": "044583151", "Name": "name", "SName": "sname", "Fam": "fam"}}'</span> 
 https://www.synq.ru/mserver2-dev/v1/payments
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"get"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10010</span><span class="w">
    </span><span class="p">}</span><span class="w">

  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089234883</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"e731a7e2-c553-4295-867e-1023359bee28"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-05-26T15:15:07.389Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"processing"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"out"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"service"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">61</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Мультибанк"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ Телефона (10 цифр)"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"9267101283"</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"BIK"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"БИК"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"044583151"</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Name"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Имя Отправителя"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"SName"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Отчество Отправителя"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"sname"</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Fam"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Фамилия Отправителя"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"fam"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="s2">"outbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ТПР (провайдер)"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h3 id='kody-oshibok'>Коды ошибок</h3>
<ul>
<li><code class="prettyprint">missing_type</code> - отсутствует обязательный параметр type</li>
<li><code class="prettyprint">missing_client_payment_id</code> - отсутствует обязательный параметр client_payment_id</li>
<li><code class="prettyprint">missing_amount</code> - отсутствует обязательный параметр amount</li>
<li><code class="prettyprint">invalid_amount</code> - неверная сумма платежа, должно быть min &lt;= amount &lt;= max, где min и max - минимальная и максимальная сумма для Сервиса</li>
<li><code class="prettyprint">missing_service</code> - отсутствует обязательный параметр service</li>
<li><code class="prettyprint">service_not_found</code> - запрошенный сервис не найдет</li>
<li><code class="prettyprint">missing_parameters</code> - не передан обязательный параметр parameters</li>
</ul>

          <h1 id='perevod-mezhdu-koshelkami'>Перевод между кошельками</h1><h3 id='parametry'>Параметры</h3>
<ul>
<li><code class="prettyprint">type</code> = p2p - тип платежа</li>
<li><code class="prettyprint">client_payment_id</code> - клиентский идентификатор платежа</li>
<li><code class="prettyprint">amount</code> -  сумма перевода</li>
<li><code class="prettyprint">destination</code> - кошелек назначения перевода</li>
<li><code class="prettyprint">message</code> - сообщение адресату перевода (опционально)</li>
</ul>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span> 
 -d <span class="s1">'{"type": "p2p", "client_payment_id": "071c6d23-7508-4e35-ad92-852308a47677", "amount": 100, "destination": "+79261111112", "message": "Съешь ещё этих мягких французских булок, да выпей чаю"}'</span>   https://www.synq.ru/mserver2-dev/v1/payments
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pay"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10010</span><span class="w">
    </span><span class="p">}</span><span class="w">

  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089237211</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"071c6d23-7508-4e35-ad92-852308a47677"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">100.00</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-01T06:30:01.277Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"p2p"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"destination"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111112"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"message"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Съешь ещё этих мягких французских булок, да выпей чаю"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h3 id='kody-oshibok'>Коды ошибок</h3>
<ul>
<li><code class="prettyprint">missing_type</code> - отсутствует обязательный параметр type</li>
<li><code class="prettyprint">missing_client_payment_id</code> - отсутствует обязательный параметр client_payment_id</li>
<li><code class="prettyprint">missing_amount</code> - отсутствует обязательный параметр amount</li>
<li><code class="prettyprint">invalid_amount</code> - сумма перевода должна быть &gt; 0</li>
<li><code class="prettyprint">missing_destination</code> - отсутствует обязательный параметр destination</li>
<li><code class="prettyprint">destination_not_found</code> - кошелек назначения платежа не найден</li>
<li><code class="prettyprint">invalid_destination</code> - попытка отправить p2p перевод самому себе</li>
<li><code class="prettyprint">insufficient_funds</code> - недостаточно средств для выполнения p2p перевода</li>
<li><code class="prettyprint">wallet_not_identified</code> - отправитель p2p перевода не идентифицирован</li>
<li><code class="prettyprint">destination_wallet_not_identified</code> - получатель p2p перевода не идентифицирован</li>
</ul>

          <h1 id='popolnenie-koshelka'>Пополнение кошелька</h1>
<p>Пополнение кошелька пользователя через запросы к API возможно с использованием пластиковых карт. Существуют 3 сценария пополнения кошелька с карты:</p>

<ul>
<li>однократное пополнение</li>
<li>однократное пополнение с сохранением данных карты для последующего использования (&ldquo;привязка карты&rdquo;)</li>
<li>пополнение с сохраненной ранее карты (&ldquo;рекарринг&rdquo;)</li>
</ul>
<h3 id='parametry'>Параметры</h3>
<ul>
<li><code class="prettyprint">type</code> = in - тип платежа</li>
<li><code class="prettyprint">client_payment_id</code> - клиентский идентификатор платежа</li>
<li><code class="prettyprint">amount</code> -  сумма к зачислению</li>
<li><code class="prettyprint">store_card</code> - <code class="prettyprint">true</code> | <code class="prettyprint">false</code> - сохранить карту, чтобы использовать ее для платежей в дальнейшем (опциональный)</li>
<li><code class="prettyprint">card</code> - идентификатор сохраненной карты с которой будут списаны деньги (опциональный)</li>
</ul>
<h2 id='odnokratnoe'>Однократное</h2>
<blockquote>
<p>Создаем платеж:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span> 
 -d <span class="s1">'{"type": "in", "client_payment_id": "071c6d23-7508-4e35-ad92-852308a47678", "amount": 100}'</span>
 https://www.synq.ru/mserver2-dev/v1/payments
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pay"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10010</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089237212</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"071c6d23-7508-4e35-ad92-852308a47678"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">100.00</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-01T06:55:27.870Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>Платим:</p>
</blockquote>
<pre class="highlight shell"><code><span class="nv">$curl</span> -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span> 
 -X POST https://www.synq.ru/mserver2-dev/v1/payments/1401089237212/pay
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"get"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10010</span><span class="w">
    </span><span class="p">}</span><span class="w">

  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089237212</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"071c6d23-7508-4e35-ad92-852308a47678"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-01T06:55:27.870Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"processing"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pending"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"payment_page_url"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://test1.ipsp.com/frontend/endpoint?product_id=1721&amp;desc=mserver2&amp;payment_type=S&amp;amount=100.00&amp;currency=RUB&amp;cf=1401089237212&amp;locale=ru&amp;hash=3d49fa2b7ceb67f8ad7ed7f2247dd2cad1c4acdc"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>далее следует перенаправить пользователя на платежную страницу по ссылке из поля <code class="prettyprint">card.payment_page_url</code>.</p>
</blockquote>
<h2 id='s-sohraneniem-dannyh-karty'>С сохранением данных карты</h2>
<blockquote>
<p>Создаем платеж:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span> 
 -d <span class="s1">'{"type": "in", "client_payment_id": "071c6d23-7508-4e35-ad92-852308a47679", "amount": 100, "store_card": true}'</span> https://www.synq.ru/mserver2-dev/v1/payments
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pay"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10010</span><span class="w">
    </span><span class="p">}</span><span class="w">

  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089237231</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"071c6d23-7508-4e35-ad92-852308a47679"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">100.00</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-01T08:31:24.058Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>Платим:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password-H <span class="s1">'Content-type:application/json'</span> 
-X POST https://www.synq.ru/mserver2-dev/v1/payments/1401089237231/pay
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"get"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10010</span><span class="w">
    </span><span class="p">}</span><span class="w">

  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089237231</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"071c6d23-7508-4e35-ad92-852308a47679"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-01T08:31:24.058Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"processing"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pending"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"payment_page_url"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://test1.ipsp.com/frontend/endpoint?product_id=1721&amp;desc=mserver2&amp;payment_type=S&amp;amount=100.00&amp;currency=RUB&amp;cf=1401089237231&amp;locale=ru&amp;biller_client_id=21&amp;perspayee_expiry=0150&amp;recur_freq=1&amp;hash=5136f2cb7fd77f98b1df86d4644338e5a10dab98"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>далее следует перенаправить пользователя на платежную страницу по ссылке из поля <code class="prettyprint">card.payment_page_url</code>.</p>

<p><strong><em>Убедимся, что платеж успешен и карта сохранена</em></strong></p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:passwordhttps://www.synq.ru/mserver2-dev/v1/payments/1401089237231
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10010</span><span class="w">
    </span><span class="p">}</span><span class="w">

  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089237231</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"071c6d23-7508-4e35-ad92-852308a47679"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-01T08:31:24.058Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"processed_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-01T08:39:40.173Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"completed"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******2399"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='c-sohranennoy-karty'>C сохраненной карты</h2>
<blockquote>
<p>Используем карту #21 сохраненную в предыдущем примере.</p>

<p>Создаем платеж:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password-H <span class="s1">'Content-type:application/json'</span>
 -d <span class="s1">'{"type": "in", "client_payment_id": "071c6d23-7508-4e35-ad92-852308a47689", "amount": 100, "card": 21}'</span>  
 https://www.synq.ru/mserver2-dev/v1/payments
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pay"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10010</span><span class="w">
    </span><span class="p">}</span><span class="w">

  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089237232</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"071c6d23-7508-4e35-ad92-852308a47653"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">100.00</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-01T08:58:51.143Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******2399"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>Платим:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span> X POST https://www.synq.ru/mserver2-dev/v1/payments/1401089237232/pay
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"get"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10010</span><span class="w">
    </span><span class="p">}</span><span class="w">

  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1401089237232</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"071c6d23-7508-4e35-ad92-852308a47653"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-07-01T12:04:49.330Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"processing"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******2399"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

          <h1 id='tranzitnyy-platezh'>Транзитный платеж</h1>
<p>Транзитный платеж соединяет в одном действии зачисление денег на кошелек через поставщика ввода средств (в настоящее время ИПСП) и списание денег со счета кошелька в пользу поставщика вывода средств (в настоящее время КредитПилот).</p>

<p>По аналогии с пополнением кошелька возможны следующие варианты транзитного платежа:</p>

<ul>
<li>однократное списание с карты</li>
<li>однократное списание с карты с сохранением данных карты для последующего использования (&ldquo;привязка карты&rdquo;)</li>
<li>списание средств с сохраненной ранее карты (&ldquo;рекарринг&rdquo;)</li>
</ul>
<h3 id='parametry'>Параметры</h3>
<ul>
<li><code class="prettyprint">type</code> = inout - тип платежа</li>
<li><code class="prettyprint">client_payment_id</code> - клиентский идентификатор платежа (опциональный)</li>
<li><code class="prettyprint">amount</code> -  сумма к зачислению</li>
<li><code class="prettyprint">store_card</code> - <code class="prettyprint">true</code> | <code class="prettyprint">false</code> - сохранить карту, чтобы использовать ее для платежей в дальнейшем (опциональный)</li>
<li><code class="prettyprint">card</code> - идентификатор сохраненной карты с которой будут списаны деньги (опциональный)</li>
<li><code class="prettyprint">service</code> - назначение платежа, идентификатор Сервиса</li>
<li><code class="prettyprint">parameters</code> - параметры платежного запроса в соответствии с /services/{service}</li>
</ul>
<h2 id='odnokratnoe-spisanie-s-karty'>Однократное списание с карты</h2>
<blockquote>
<p>Создаем платеж:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span> 
-d <span class="s1">'{"type": "inout", "amount": 100, "service": 834, "parameters": {"phoneNumber": "9267101283"}}'</span> 
https://www.synq.ru/mserver2-dev/v1/payments
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pay"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">18357</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"9de7de50-cb15-40f0-a953-c77df91803c9"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">100.00</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-02-02T12:23:57.548Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"inout"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"service"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">834</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Мегафон"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ Телефона"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"9267101283"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"outbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Кредит Пилот"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"wallet"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h3 id='parametry-dlya-etapa-podtverzhdeniya-platezha-pay'>Параметры (для этапа подтверждения платежа /pay)</h3>
<ul>
<li><code class="prettyprint">card_success_url</code> - URL на который пользователь будет перенаправлен в случае успешного сохранения карты, опционально</li>
<li><code class="prettyprint">card_failure_url</code> - URL на который пользователь будет перенаправлен в случае неуспешного сохранения карты, опционально</li>
</ul>
<h3 id='kody-oshibok'>Коды ошибок</h3>
<ul>
<li><code class="prettyprint">active_cards_limit</code> - превышено максимально возможное количество активных карт</li>
</ul>

<blockquote>
<p>Платим:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span> -X POST 
https://www.synq.ru/mserver2-dev/v1/payments/18357/pay
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"get"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">18357</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"9de7de50-cb15-40f0-a953-c77df91803c9"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-02-02T12:23:57.548Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"processing"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"inout"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"service"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">834</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Мегафон"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ Телефона"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"9267101283"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"outbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Кредит Пилот"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pending"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"payment_page_url"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://test1.ipsp.com/frontend/endpoint?product_id=1721&amp;desc=BestWallet&amp;payment_type=S&amp;amount=100.00&amp;currency=RUB&amp;cf=18357&amp;locale=ru&amp;hash=1a6752f0f13df41aaa7dd24419ab04b1b1743b15"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"wallet"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>далее следует перенаправить пользователя на платежную страницу по ссылке из поля <code class="prettyprint">card.payment_page_url</code>.</p>

<p>Проверяем статус платежа:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span> 
https://www.synq.ru/mserver2-dev/v1/payments/18357
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"get"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">18357</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"9de7de50-cb15-40f0-a953-c77df91803c9"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-02-02T12:23:57.548Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"processed_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-02-02T12:27:13.279Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"completed"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"inout"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"service"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">834</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Мегафон"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ Телефона"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"9267101283"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"outbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Кредит Пилот"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"used"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******7260"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"wallet"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"remote_check"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1422880082862"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>Платеж успешен.</p>
</blockquote>
<h2 id='s-sohraneniem-dannyh-karty'>С сохранением данных карты</h2>
<p>Сценарий ничем не отличается от предыдущего, кроме передачи флага &ldquo;store_card&rdquo;: true при создании платежа. 
Идентификатор карты, возвращенный в <code class="prettyprint">data.card.id</code> можно впоследствии использовать для пополнения счета кошелька 
или выполнения транзитных платежей с сохраненной карты.</p>

<blockquote>
<p>Создаем платеж:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span> 
-d <span class="s1">'{"type": "inout", "amount": 100, "store_card": true, "service": 834, "parameters": {"phoneNumber": "9267101283"}}'</span> 
https://www.synq.ru/mserver2-dev/v1/payments
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pay"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">18387</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"f80143c5-29aa-4514-8aee-94acc3c3a026"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">100.00</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-02-02T13:06:35.191Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"inout"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"service"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">834</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Мегафон"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ Телефона"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"9267101283"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"outbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Кредит Пилот"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">7221</span><span class="p">,</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"wallet"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h3 id='parametry-dlya-etapa-podtverzhdeniya-platezha-pay'>Параметры (для этапа подтверждения платежа /pay)</h3>
<ul>
<li><code class="prettyprint">card_success_url</code> - URL на который пользователь будет перенаправлен в случае успешного сохранения карты, опционально</li>
<li><code class="prettyprint">card_failure_url</code> - URL на который пользователь будет перенаправлен в случае неуспешного сохранения карты, опционально</li>
</ul>
<h3 id='kody-oshibok'>Коды ошибок</h3>
<ul>
<li><code class="prettyprint">active_cards_limit</code> - превышено максимально возможное количество активных карт</li>
</ul>

<blockquote>
<p>Платим:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span> -X POST 
https://www.synq.ru/mserver2-dev/v1/payments/18387/pay
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"get"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">18387</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"f80143c5-29aa-4514-8aee-94acc3c3a026"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-02-02T13:06:35.191Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"processing"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"inout"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"service"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">834</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Мегафон"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ Телефона"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"9267101283"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"outbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Кредит Пилот"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">7221</span><span class="p">,</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pending"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"payment_page_url"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://test1.ipsp.com/frontend/endpoint?product_id=1721&amp;desc=BestWallet&amp;payment_type=S&amp;amount=100.00&amp;currency=RUB&amp;cf=18386&amp;locale=ru&amp;biller_client_id=82c9273ea7e0455d96efd0864f3042a6&amp;perspayee_expiry=0150&amp;recur_freq=1&amp;hash=9621bc5f10d1430b2143fcbdb3c6a4be9b545aba"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"wallet"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>далее следует перенаправить пользователя на платежную страницу по ссылке из поля <code class="prettyprint">card.payment_page_url</code>.</p>

<p>Проверяем статус платежа:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password https://www.synq.ru/mserver2-dev/v1/payments/18387
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"get"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">18387</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1fa097f7-63a3-4778-aa3c-c62fc5e85045"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-02-02T13:24:12.185Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"processed_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-02-02T13:24:57.711Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"completed"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"inout"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"service"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">834</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Мегафон"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ Телефона"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"9267101283"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"outbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Кредит Пилот"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">7222</span><span class="p">,</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******6825"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"wallet"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"remote_check"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1422883547606"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>Платеж успешен. Карта с ID 7222 успешно сохранена (имеет статус <code class="prettyprint">active</code>).</p>
</blockquote>
<h2 id='c-sohranennoy-karty'>C сохраненной карты</h2>
<p>Транзитный платеж с сохраненной карты отличается от платежа с однократным списанием только указанием идентификатора карты в поле <code class="prettyprint">card</code> при создании платежа.</p>

<blockquote>
<p>Создаем платеж используя карту с ID 7222, сохраненную в примере выше:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span> 
-d <span class="s1">'{"type": "inout", "amount": 100, "card": 7222, "service": 834, "parameters": {"phoneNumber": "9267101283"}}'</span> 
https://www.synq.ru/mserver2-dev/v1/payments
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pay"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">18388</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"8ff2a629-e397-42f5-9610-c6dbd12627d0"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">100.00</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-02-02T13:31:01.643Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"inout"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"service"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">834</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Мегафон"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ Телефона"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"9267101283"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"outbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Кредит Пилот"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">7222</span><span class="p">,</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******6825"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"wallet"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>Платим:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span> -X POST 
https://www.synq.ru/mserver2-dev/v1/payments/18388/pay
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"get"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">18388</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"8ff2a629-e397-42f5-9610-c6dbd12627d0"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-02-02T13:31:01.643Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"processing"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"inout"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"service"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">834</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Мегафон"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ Телефона"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"9267101283"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"outbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Кредит Пилот"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">7222</span><span class="p">,</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******6825"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"wallet"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>Проверяем статус платежа:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password https://www.synq.ru/mserver2-dev/v1/payments/18388
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"get"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">18388</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"8ff2a629-e397-42f5-9610-c6dbd12627d0"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-02-02T13:31:01.643Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"processed_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-02-02T13:32:14.429Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"completed"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"inout"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"service"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">834</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Мегафон"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ Телефона"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"9267101283"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"outbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Кредит Пилот"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">7222</span><span class="p">,</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******6825"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"wallet"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>Платеж успешен. </p>
</blockquote>
<h2 id='otlozhennyy-vybor-tipa-platezha'>Отложенный выбор типа платежа</h2>
<p>Пользователь может отложить выбор типа платежа между <code class="prettyprint">out</code> и <code class="prettyprint">inout</code> до подтверждения платежа.
Платеж может быть создан, как платеж со счета кошелька <code class="prettyprint">out</code>, затем, если клиент передумал и решил заплатить картой, 
при подтверждении платежа вызовом </p>

<p><code class="prettyprint">POST</code> /payments/{:id}/pay </p>

<p>нужно передать в теле запроса следующие поля:</p>
<h3 id='polya-zaprosa-podtverzhdeniya-platezha-dlya-smeny-tipa-in--gt-inout'>Поля запроса подтверждения платежа для смены типа in -&gt; inout</h3>
<ul>
<li><code class="prettyprint">type</code> = inout - тип платежа</li>
<li><code class="prettyprint">store_card</code> - <code class="prettyprint">true</code> | <code class="prettyprint">false</code> - сохранить карту, чтобы использовать ее для платежей в дальнейшем (опциональный)</li>
<li><code class="prettyprint">card</code> - идентификатор сохраненной карты с которой будут списаны деньги (опциональный)</li>
</ul>

<blockquote>
<p>Создаем платеж используя кошелек как источник средств:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span> 
-d <span class="s1">'{"type": "out", "amount": 100, "card": 7222, "service": 834, "parameters": {"phoneNumber": "9267101283"}}'</span> 
https://www.synq.ru/mserver2-dev/v1/payments
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pay"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">19493</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"11140dd2-f002-4970-8603-fb48dc299673"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">100.00</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-02-09T11:36:54.263Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"out"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"service"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">834</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Мегафон"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ Телефона"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"9267101283"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="s2">"outbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Кредит Пилот"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"wallet"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>Решаем заплатить сохраненной картой с ID 7222:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span> 
-d <span class="s1">'{"type": "inout", "card": 7222}'</span>
https://www.synq.ru/mserver2-dev/v1/payments/19493/pay
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"get"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">19493</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"11140dd2-f002-4970-8603-fb48dc299673"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-02-09T11:36:54.263Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"processing"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"inout"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"service"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">834</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Мегафон"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ Телефона"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"9267101283"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"outbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Кредит Пилот"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">7222</span><span class="p">,</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******6825"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"wallet"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>Проверяем статус платежа:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password https://www.synq.ru/mserver2-dev/v1/payments/19493
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"urgent_data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"next_action"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"get"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">19493</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_payment_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"11140dd2-f002-4970-8603-fb48dc299673"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-02-09T11:36:54.263Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"processed_at"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-02-09T11:40:17.546Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"completed"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"inout"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"service"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">834</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Мегафон"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"phoneNumber"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"№ Телефона"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"9267101283"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="s2">"inbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ipsp_in"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ООО ИПСП (агент)"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"outbound"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tpr_out"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Кредит Пилот"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"card"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">7222</span><span class="p">,</span><span class="w">
      </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******6825"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"wallet"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+79261111111"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"remote_check"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1423482079404"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>Платеж успешен. </p>
</blockquote>

          <h1 id='karty'>Карты</h1>
<p>Карта - это сохраненный в mserver токен, с помощью которого пользователь кошелька может пополнять счет без ввода данных пластиковой карты.</p>
<h3 id='polya'>Поля</h3>
<ul>
<li><code class="prettyprint">id</code> - уникальный идентификатор карты</li>
<li><code class="prettyprint">state</code> - состояние карты, см. ниже</li>
<li><code class="prettyprint">title</code> - название карты, в качестве названия сейчас используется маскированный номер карты</li>
<li><code class="prettyprint">type</code> - бренд карты: Visa/MasterCard/&hellip;</li>
</ul>
<h3 id='sostoyaniya-karty'>Состояния карты</h3>
<table><thead>
<tr>
<th style="text-align: left">Код состояния карты</th>
<th style="text-align: left">Описание</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code class="prettyprint">created</code></td>
<td style="text-align: left">Карта только что создана</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">pending</code></td>
<td style="text-align: left">Карта сохраняется (ожидается уведомление от IPSP о успехе/неуспехе карточной транзакции</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">active</code></td>
<td style="text-align: left">Карта сохранена, может быть использована для повторных платежей</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">failed</code></td>
<td style="text-align: left">Карта не сохранена (и уже не будет)</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">used</code></td>
<td style="text-align: left">Карта использована для однократного пополнения</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">deleted</code></td>
<td style="text-align: left">Карта удалена</td>
</tr>
</tbody></table>
<h2 id='sozdanie-karty'>Создание карты</h2><h3 id='parametry'>Параметры</h3>
<ul>
<li><code class="prettyprint">card_success_url</code> - URL на который пользователь будет перенаправлен в случае успешного сохранения карты, опционально</li>
<li><code class="prettyprint">card_failure_url</code> - URL на который пользователь будет перенаправлен в случае неуспешного сохранения карты, опционально</li>
</ul>
<h3 id='kody-oshibok'>Коды ошибок</h3>
<ul>
<li><code class="prettyprint">active_cards_limit</code> - превышено максимально возможное количество активных карт</li>
</ul>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span> -d <span class="s1">'{"card_success_url": "http://ya.ru", "card_failure_url": "http://google.com"}'</span> https://www.synq.ru/mserver2-dev/v1/cards
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
    </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pending"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"payment_page_url"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://test1.ipsp.com/frontend/endpoint?product_id=1721&amp;desc=mserver2&amp;payment_type=A&amp;amount=1.00&amp;currency=RUB&amp;biller_client_id=1f95c7b9-74e5-4fd7-983d-c8d03d90347e&amp;perspayee_expiry=0150&amp;recur_freq=1&amp;locale=ru&amp;hash=cace0d7de544a25d2aa685ef12263a10655d9058"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>После создания карты следует перенаправить пользователя на платежную страницу по ссылке из поля <code class="prettyprint">payment_page_url</code>. После ввода пользователем данных карты на платежной странице  и получения mserver уведомления от IPSP об успехе или неуспехе карточной транзакции карта перейдет в состояние <code class="prettyprint">active</code> или <code class="prettyprint">failed</code>.</p>
<h2 id='zagruzka-karty'>Загрузка карты</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span> https://www.synq.ru/mserver2-dev/v1/cards/62
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
    </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******2399"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Как видно, карта успешно сохранена и может быть использована для пополнения счета кошелька.</p>
<h2 id='poluchenie-spiska-kart'>Получение списка карт</h2><pre class="highlight shell"><code><span class="gp">$ </span>curl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span> https://www.synq.ru/mserver2-dev/v1/cards?state<span class="o">=</span>active,pending
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="s2">"page"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"total_elements"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
    </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******2399"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Опциональный параметр <code class="prettyprint">state</code> позволяет фильтровать карты по состоянию.</p>
<h2 id='udalenie-karty'>Удаление карты</h2><pre class="highlight shell"><code><span class="gp">$ </span>сurl -u+79261111111:password -H <span class="s1">'Content-type:application/json'</span> 
 -X DELETE https://www.synq.ru/mserver2-dev/v1/cards/62
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='uvedomleniya-ob-izmenenii-statusa-privyazki-karty'>Уведомления об изменении статуса привязки карты</h2>
<p>Для уведомления внешней системы об изменениях статуса карты mserver выполняет POST запрос на URL /cards/status. Уведомление передается в теле POST запроса в виде объекта карты сериализованного в JSON. Например:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">62</span><span class="p">,</span><span class="w">
    </span><span class="s2">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"541715******2399"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MasterCard"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"wallet"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="s2">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"+792611111111"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h2 id='dannye-testovyh-kart'>Данные тестовых карт</h2>
<table><thead>
<tr>
<th style="text-align: left">Номер карты</th>
<th style="text-align: left">Срок действия</th>
<th style="text-align: right">CVV2/CVC2</th>
<th style="text-align: center">3D-Secure</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">5417150893587260</td>
<td style="text-align: left">01/17</td>
<td style="text-align: right">082</td>
<td style="text-align: center">&#x2713;</td>
</tr>
<tr>
<td style="text-align: left">5417150396276825</td>
<td style="text-align: left">01/17</td>
<td style="text-align: right">789</td>
<td style="text-align: center">&#x2717;</td>
</tr>
<tr>
<td style="text-align: left">4652060573334999</td>
<td style="text-align: left">01/17</td>
<td style="text-align: right">067</td>
<td style="text-align: center">&#x2713;</td>
</tr>
<tr>
<td style="text-align: left">4652060724922338</td>
<td style="text-align: left">01/17</td>
<td style="text-align: right">989</td>
<td style="text-align: center">&#x2717;</td>
</tr>
</tbody></table>

<p>Пароль 3D-Secure: 123456.</p>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
